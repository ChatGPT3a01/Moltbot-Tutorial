<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenClaw Skill ç”Ÿæˆå™¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .header h1 { font-size: 42px; margin-bottom: 10px; text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .header p { font-size: 18px; opacity: 0.9; }

        .nav-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .nav-link {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }
        .nav-link:hover { background: rgba(255,255,255,0.4); }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        @media (max-width: 1000px) {
            .main-grid { grid-template-columns: 1fr; }
        }

        .panel {
            background: rgba(255,255,255,0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .panel h2 {
            color: #667eea;
            font-size: 24px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 15px;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .form-group small {
            display: block;
            color: #888;
            margin-top: 5px;
            font-size: 13px;
        }

        .template-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
        }
        .template-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .template-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .template-card.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }
        .template-card .icon { font-size: 32px; margin-bottom: 8px; }
        .template-card .name { font-size: 13px; font-weight: 600; }

        .btn {
            display: inline-block;
            padding: 14px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(102,126,234,0.4);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102,126,234,0.5);
        }
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        .btn-success:hover {
            transform: translateY(-2px);
        }
        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .preview-section {
            margin-top: 20px;
        }
        .preview-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        .preview-tab {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }
        .preview-tab.active {
            background: #1e1e1e;
            color: #fff;
        }
        .preview-content {
            background: #1e1e1e;
            border-radius: 0 12px 12px 12px;
            padding: 20px;
            max-height: 400px;
            overflow: auto;
        }
        .preview-content pre {
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            margin: 0;
        }
        .preview-content .comment { color: #6a9955; }
        .preview-content .keyword { color: #569cd6; }
        .preview-content .string { color: #ce9178; }
        .preview-content .variable { color: #9cdcfe; }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr; }
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
        }
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .checkbox-group label {
            cursor: pointer;
            font-size: 14px;
            margin: 0;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin: 20px 0;
            font-size: 14px;
            color: #0d47a1;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin: 20px 0;
            color: #155724;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš¡ OpenClaw Skill ç”Ÿæˆå™¨</h1>
            <p>è‡ªè¨‚ä½ çš„é¾è¦æŠ€èƒ½ï¼Œä¸€éµä¸‹è¼‰ä½¿ç”¨</p>
            <div class="nav-links">
                <a href="index.html" class="nav-link">ğŸ  é¦–é </a>
                <a href="Skill-DiskAudit.html" class="nav-link">ğŸ“ ç£ç¢Ÿç›¤é»æ•™å­¸</a>
                <a href="Skill-GoogleDrive.html" class="nav-link">â˜ï¸ é›²ç«¯ä¸Šå‚³æ•™å­¸</a>
                <a href="Skill-BrowserRelay.html" class="nav-link">ğŸŒ ç¶²é æ“ä½œæ•™å­¸</a>
            </div>
        </div>

        <div class="main-grid">
            <!-- å·¦å´ï¼šè¨­å®šé¢æ¿ -->
            <div class="panel">
                <h2>ğŸ“ ç¬¬ä¸€æ­¥ï¼šé¸æ“‡ Skill é¡å‹</h2>
                <div class="template-cards">
                    <div class="template-card selected" data-template="disk-audit">
                        <div class="icon">ğŸ“</div>
                        <div class="name">ç£ç¢Ÿç›¤é»</div>
                    </div>
                    <div class="template-card" data-template="gdrive-upload">
                        <div class="icon">â˜ï¸</div>
                        <div class="name">é›²ç«¯ä¸Šå‚³</div>
                    </div>
                    <div class="template-card" data-template="web-scraper">
                        <div class="icon">ğŸ•·ï¸</div>
                        <div class="name">ç¶²é çˆ¬èŸ²</div>
                    </div>
                    <div class="template-card" data-template="scheduler">
                        <div class="icon">â°</div>
                        <div class="name">æ’ç¨‹æé†’</div>
                    </div>
                    <div class="template-card" data-template="file-organizer">
                        <div class="icon">ğŸ“‚</div>
                        <div class="name">æª”æ¡ˆæ•´ç†</div>
                    </div>
                    <div class="template-card" data-template="backup">
                        <div class="icon">ğŸ’¾</div>
                        <div class="name">è‡ªå‹•å‚™ä»½</div>
                    </div>
                    <div class="template-card" data-template="custom">
                        <div class="icon">ğŸ”§</div>
                        <div class="name">è‡ªè¨‚ Skill</div>
                    </div>
                </div>

                <h2>âš™ï¸ ç¬¬äºŒæ­¥ï¼šè‡ªè¨‚è¨­å®š</h2>

                <div class="form-group">
                    <label>Skill åç¨±</label>
                    <input type="text" id="skillName" placeholder="ä¾‹å¦‚ï¼šmy-disk-audit">
                    <small>åªèƒ½ç”¨è‹±æ–‡ã€æ•¸å­—å’Œé€£å­—è™Ÿ</small>
                </div>

                <div class="form-group">
                    <label>Skill èªªæ˜</label>
                    <input type="text" id="skillDescription" placeholder="ä¾‹å¦‚ï¼šè‡ªå‹•ç›¤é»ç£ç¢Ÿä¸¦ç”¢ç”Ÿå ±å‘Š">
                </div>

                <!-- ç£ç¢Ÿç›¤é»é¸é … -->
                <div id="options-disk-audit" class="template-options">
                    <div class="form-group">
                        <label>æƒæè·¯å¾‘ï¼ˆæ¯è¡Œä¸€å€‹ï¼‰</label>
                        <textarea id="scanPaths" placeholder="C:\Users\user\Downloads&#10;C:\Users\user\Desktop&#10;D:\Documents"></textarea>
                    </div>
                    <div class="options-grid">
                        <div class="form-group">
                            <label>å¤§æª”é–€æª» (MB)</label>
                            <input type="number" id="largeFileMB" value="500" min="1">
                        </div>
                        <div class="form-group">
                            <label>é¡¯ç¤ºå‰å¹¾å</label>
                            <input type="number" id="topN" value="30" min="1" max="100">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>åŠŸèƒ½é¸é …</label>
                        <div class="options-grid">
                            <div class="checkbox-group">
                                <input type="checkbox" id="optLargeFiles" checked>
                                <label for="optLargeFiles">æ‰¾å¤§æª”æ¡ˆ</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="optRecentFiles" checked>
                                <label for="optRecentFiles">æœ€è¿‘ä¿®æ”¹</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="optExtStats" checked>
                                <label for="optExtStats">å‰¯æª”åçµ±è¨ˆ</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="optDuplicates">
                                <label for="optDuplicates">é‡è¤‡æª”åµæ¸¬</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- é›²ç«¯ä¸Šå‚³é¸é … -->
                <div id="options-gdrive-upload" class="template-options hidden">
                    <div class="form-group">
                        <label>é ç«¯è³‡æ–™å¤¾åç¨±</label>
                        <input type="text" id="remoteFolder" value="OpenClaw-Uploads">
                    </div>
                    <div class="form-group">
                        <label>rclone Remote åç¨±</label>
                        <input type="text" id="remoteName" value="gdrive">
                        <small>é è¨­æ˜¯ gdriveï¼Œé™¤éä½ åœ¨ rclone config ç”¨äº†å…¶ä»–åå­—</small>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="optAutoLink" checked>
                        <label for="optAutoLink">è‡ªå‹•ç”¢ç”Ÿåˆ†äº«é€£çµ</label>
                    </div>
                </div>

                <!-- ç¶²é çˆ¬èŸ²é¸é … -->
                <div id="options-web-scraper" class="template-options hidden">
                    <div class="form-group">
                        <label>ç›®æ¨™ç¶²å€ï¼ˆæ¯è¡Œä¸€å€‹ï¼‰</label>
                        <textarea id="targetUrls" placeholder="https://example.com/news&#10;https://example.com/prices"></textarea>
                    </div>
                    <div class="form-group">
                        <label>çˆ¬èŸ²æ¨¡å¼</label>
                        <select id="scrapeMode">
                            <option value="light">Light fetchï¼ˆè¼•é‡ï¼Œç´” HTMLï¼‰</option>
                            <option value="dynamic">Dynamic JSï¼ˆç­‰ JavaScript è¼‰å…¥ï¼‰</option>
                            <option value="monitor">Scheduled monitorï¼ˆå®šæ™‚ç›£æ§è®ŠåŒ–ï¼‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>è¦æŠ“å–çš„è³‡æ–™ï¼ˆCSS é¸æ“‡å™¨ï¼‰</label>
                        <input type="text" id="cssSelector" placeholder="ä¾‹å¦‚ï¼š.news-title, #price, article h2">
                    </div>
                </div>

                <!-- æ’ç¨‹æé†’é¸é … -->
                <div id="options-scheduler" class="template-options hidden">
                    <div class="form-group">
                        <label>æé†’å…§å®¹</label>
                        <textarea id="reminderContent" placeholder="ä¾‹å¦‚ï¼šè©²å–æ°´äº†ï¼&#10;è¨˜å¾—ç«™èµ·ä¾†èµ°å‹•ä¸€ä¸‹"></textarea>
                    </div>
                    <div class="options-grid">
                        <div class="form-group">
                            <label>åŸ·è¡Œæ™‚é–“</label>
                            <input type="time" id="scheduleTime" value="09:00">
                        </div>
                        <div class="form-group">
                            <label>é‡è¤‡é »ç‡</label>
                            <select id="scheduleFreq">
                                <option value="daily">æ¯å¤©</option>
                                <option value="weekday">é€±ä¸€åˆ°é€±äº”</option>
                                <option value="weekly">æ¯é€±</option>
                                <option value="hourly">æ¯å°æ™‚</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- æª”æ¡ˆæ•´ç†é¸é … -->
                <div id="options-file-organizer" class="template-options hidden">
                    <div class="form-group">
                        <label>ä¾†æºè³‡æ–™å¤¾</label>
                        <input type="text" id="sourceFolder" placeholder="C:\Users\user\Downloads">
                    </div>
                    <div class="form-group">
                        <label>æ•´ç†è¦å‰‡</label>
                        <select id="organizeRule">
                            <option value="extension">ä¾å‰¯æª”ååˆ†é¡</option>
                            <option value="date">ä¾æ—¥æœŸåˆ†é¡</option>
                            <option value="size">ä¾å¤§å°åˆ†é¡</option>
                        </select>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="optMoveFiles">
                        <label for="optMoveFiles">ç§»å‹•æª”æ¡ˆï¼ˆä¸å‹¾é¸å‰‡åªç”¢ç”Ÿå ±å‘Šï¼‰</label>
                    </div>
                </div>

                <!-- è‡ªå‹•å‚™ä»½é¸é … -->
                <div id="options-backup" class="template-options hidden">
                    <div class="form-group">
                        <label>å‚™ä»½ä¾†æºï¼ˆæ¯è¡Œä¸€å€‹ï¼‰</label>
                        <textarea id="backupSources" placeholder="C:\Users\user\Documents&#10;C:\Users\user\Pictures"></textarea>
                    </div>
                    <div class="form-group">
                        <label>å‚™ä»½ç›®çš„åœ°</label>
                        <input type="text" id="backupDest" placeholder="D:\Backups æˆ– gdrive:Backups">
                    </div>
                    <div class="form-group">
                        <label>å‚™ä»½æ¨¡å¼</label>
                        <select id="backupMode">
                            <option value="copy">å®Œæ•´è¤‡è£½</option>
                            <option value="sync">åŒæ­¥ï¼ˆåˆªé™¤ç›®çš„åœ°å¤šé¤˜æª”æ¡ˆï¼‰</option>
                            <option value="incremental">å¢é‡å‚™ä»½</option>
                        </select>
                    </div>
                </div>

                <!-- è‡ªè¨‚ Skill é¸é … -->
                <div id="options-custom" class="template-options hidden">
                    <div class="form-group">
                        <label>è§¸ç™¼æŒ‡ä»¤</label>
                        <input type="text" id="customTrigger" placeholder="ä¾‹å¦‚ï¼šåŸ·è¡Œæˆ‘çš„ä»»å‹™">
                        <small>è·Ÿé¾è¦èªªé€™å¥è©±å°±æœƒåŸ·è¡Œæ­¤ Skill</small>
                    </div>
                    <div class="form-group">
                        <label>è‡ªè¨‚è…³æœ¬å…§å®¹ (PowerShell)</label>
                        <textarea id="customScript" style="min-height:150px; font-family: Consolas, monospace;" placeholder="# åœ¨é€™è£¡å¯«ä½ çš„ PowerShell è…³æœ¬&#10;Write-Host &quot;Hello from my skill!&quot;"></textarea>
                    </div>
                </div>

                <div class="info-box">
                    ğŸ’¡ <strong>æç¤ºï¼š</strong>ç”Ÿæˆå¾Œçš„æª”æ¡ˆéœ€è¦æ”¾åˆ° <code>~/.openclaw/workspace/skills/ä½ çš„skillåç¨±/</code> è³‡æ–™å¤¾
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="generateSkill()">âš¡ ç”Ÿæˆ Skill</button>
                </div>
            </div>

            <!-- å³å´ï¼šé è¦½èˆ‡ä¸‹è¼‰ -->
            <div class="panel">
                <h2>ğŸ‘€ ç¬¬ä¸‰æ­¥ï¼šé è¦½èˆ‡ä¸‹è¼‰</h2>

                <div class="preview-section">
                    <div class="preview-tabs">
                        <button class="preview-tab active" data-tab="skill-md">SKILL.md</button>
                        <button class="preview-tab" data-tab="script">è…³æœ¬æª”æ¡ˆ</button>
                        <button class="preview-tab" data-tab="install">å®‰è£èªªæ˜</button>
                    </div>
                    <div class="preview-content">
                        <pre id="preview-skill-md"># è«‹å…ˆåœ¨å·¦å´é¸æ“‡ Skill é¡å‹ä¸¦å¡«å¯«è¨­å®š</pre>
                        <pre id="preview-script" class="hidden"># è…³æœ¬é è¦½æœƒé¡¯ç¤ºåœ¨é€™è£¡</pre>
                        <pre id="preview-install" class="hidden"># å®‰è£èªªæ˜æœƒé¡¯ç¤ºåœ¨é€™è£¡</pre>
                    </div>
                </div>

                <div id="download-section" class="hidden">
                    <div class="success-box">
                        âœ… Skill å·²ç”Ÿæˆï¼é»æ“Šä¸‹æ–¹æŒ‰éˆ•ä¸‹è¼‰æª”æ¡ˆã€‚
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="downloadFile('skill-md')">ğŸ“„ ä¸‹è¼‰ SKILL.md</button>
                        <button class="btn btn-success" onclick="downloadFile('script')">ğŸ“œ ä¸‹è¼‰è…³æœ¬</button>
                        <button class="btn btn-primary" onclick="downloadAll()">ğŸ“¦ ä¸‹è¼‰å…¨éƒ¨ (ZIP)</button>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 30px;">
                    <strong>ğŸ“‚ å®‰è£ä½ç½®ï¼š</strong><br>
                    <code>C:\Users\ä½ çš„ä½¿ç”¨è€…åç¨±\.openclaw\workspace\skills\[skillåç¨±]\</code><br><br>
                    <strong>ğŸ“ è³‡æ–™å¤¾çµæ§‹ï¼š</strong><br>
                    <code>
                    skills/<br>
                    â””â”€â”€ [skillåç¨±]/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€â”€ SKILL.md<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;â””â”€â”€ scripts/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â””â”€â”€ run.ps1
                    </code>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç•¶å‰é¸æ“‡çš„æ¨¡æ¿
        let currentTemplate = 'disk-audit';
        let generatedFiles = {};

        // ç”¨æ–¼ Markdown ç¨‹å¼ç¢¼å€å¡Šçš„è¼”åŠ©å‡½æ•¸
        const FENCE = '`' + '`' + '`';
        const BT = '`';  // å–®å€‹åå¼•è™Ÿ
        const NL = '\\`n';  // PowerShell æ›è¡Œç¬¦

        // æ¨¡æ¿å¡ç‰‡é»æ“Š
        document.querySelectorAll('.template-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                currentTemplate = card.dataset.template;

                // é¡¯ç¤ºå°æ‡‰çš„é¸é …
                document.querySelectorAll('.template-options').forEach(opt => opt.classList.add('hidden'));
                const optPanel = document.getElementById('options-' + currentTemplate);
                if (optPanel) optPanel.classList.remove('hidden');

                // æ›´æ–°é è¨­åç¨±
                updateDefaultName();
            });
        });

        // é è¦½ Tab åˆ‡æ›
        document.querySelectorAll('.preview-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.preview-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                const tabName = tab.dataset.tab;
                document.querySelectorAll('.preview-content pre').forEach(pre => pre.classList.add('hidden'));
                document.getElementById('preview-' + tabName).classList.remove('hidden');
            });
        });

        // æ›´æ–°é è¨­åç¨±
        function updateDefaultName() {
            const nameInput = document.getElementById('skillName');
            const descInput = document.getElementById('skillDescription');

            const defaults = {
                'disk-audit': { name: 'disk-audit', desc: 'ç£ç¢Ÿå¸¸æ…‹ç›¤é»/æ•´ç†å·¥å…·' },
                'gdrive-upload': { name: 'gdrive-upload', desc: 'ä¸Šå‚³æª”æ¡ˆåˆ° Google Drive' },
                'web-scraper': { name: 'web-scraper', desc: 'ç¶²é çˆ¬èŸ²æŠ“å–è³‡æ–™' },
                'scheduler': { name: 'daily-reminder', desc: 'æ¯æ—¥æ’ç¨‹æé†’' },
                'file-organizer': { name: 'file-organizer', desc: 'è‡ªå‹•æ•´ç†æª”æ¡ˆ' },
                'backup': { name: 'auto-backup', desc: 'è‡ªå‹•å‚™ä»½é‡è¦è³‡æ–™' },
                'custom': { name: 'my-custom-skill', desc: 'æˆ‘çš„è‡ªè¨‚æŠ€èƒ½' }
            };

            if (defaults[currentTemplate]) {
                nameInput.placeholder = defaults[currentTemplate].name;
                descInput.placeholder = defaults[currentTemplate].desc;
            }
        }

        // ç”Ÿæˆ Skill
        function generateSkill() {
            const skillName = document.getElementById('skillName').value || document.getElementById('skillName').placeholder;
            const skillDesc = document.getElementById('skillDescription').value || document.getElementById('skillDescription').placeholder;

            let skillMd = '';
            let script = '';
            let installGuide = '';
            let scriptFileName = 'run.ps1';

            switch (currentTemplate) {
                case 'disk-audit':
                    const result = generateDiskAudit(skillName, skillDesc);
                    skillMd = result.skillMd;
                    script = result.script;
                    scriptFileName = 'scan.ps1';
                    break;
                case 'gdrive-upload':
                    const gdriveResult = generateGdriveUpload(skillName, skillDesc);
                    skillMd = gdriveResult.skillMd;
                    script = gdriveResult.script;
                    scriptFileName = 'upload.ps1';
                    break;
                case 'web-scraper':
                    const scraperResult = generateWebScraper(skillName, skillDesc);
                    skillMd = scraperResult.skillMd;
                    script = scraperResult.script;
                    scriptFileName = 'scrape.ps1';
                    break;
                case 'scheduler':
                    const schedResult = generateScheduler(skillName, skillDesc);
                    skillMd = schedResult.skillMd;
                    script = schedResult.script;
                    scriptFileName = 'remind.ps1';
                    break;
                case 'file-organizer':
                    const orgResult = generateFileOrganizer(skillName, skillDesc);
                    skillMd = orgResult.skillMd;
                    script = orgResult.script;
                    scriptFileName = 'organize.ps1';
                    break;
                case 'backup':
                    const backupResult = generateBackup(skillName, skillDesc);
                    skillMd = backupResult.skillMd;
                    script = backupResult.script;
                    scriptFileName = 'backup.ps1';
                    break;
                case 'custom':
                    const customResult = generateCustom(skillName, skillDesc);
                    skillMd = customResult.skillMd;
                    script = customResult.script;
                    break;
            }

            // å®‰è£èªªæ˜
            installGuide = '# ' + skillName + ' å®‰è£èªªæ˜\n\n' +
'## 1. å»ºç«‹è³‡æ–™å¤¾\n' +
'åœ¨ PowerShell åŸ·è¡Œï¼š\n' +
FENCE + 'powershell\n' +
'mkdir "$env:USERPROFILE\\.openclaw\\workspace\\skills\\' + skillName + '\\scripts" -Force\n' +
FENCE + '\n\n' +
'## 2. æ”¾ç½®æª”æ¡ˆ\n' +
'- æŠŠ ' + BT + 'SKILL.md' + BT + ' æ”¾åˆ° ' + BT + '~/.openclaw/workspace/skills/' + skillName + '/' + BT + '\n' +
'- æŠŠ ' + BT + scriptFileName + BT + ' æ”¾åˆ° ' + BT + '~/.openclaw/workspace/skills/' + skillName + '/scripts/' + BT + '\n\n' +
'## 3. ä½¿ç”¨æ–¹å¼\n' +
'è·Ÿé¾è¦èªªï¼šã€ŒåŸ·è¡Œ ' + skillName + 'ã€æˆ–ã€Œè·‘' + skillDesc + 'ã€\n\n' +
'## è³‡æ–™å¤¾çµæ§‹\n' +
FENCE + '\n' +
'.openclaw/\n' +
'â””â”€â”€ workspace/\n' +
'    â””â”€â”€ skills/\n' +
'        â””â”€â”€ ' + skillName + '/\n' +
'            â”œâ”€â”€ SKILL.md\n' +
'            â””â”€â”€ scripts/\n' +
'                â””â”€â”€ ' + scriptFileName + '\n' +
FENCE + '\n';

            // å„²å­˜ç”Ÿæˆçš„æª”æ¡ˆ
            generatedFiles = {
                'skill-md': { content: skillMd, filename: 'SKILL.md' },
                'script': { content: script, filename: scriptFileName },
                'install': { content: installGuide, filename: 'INSTALL.md' }
            };

            // æ›´æ–°é è¦½
            document.getElementById('preview-skill-md').textContent = skillMd;
            document.getElementById('preview-script').textContent = script;
            document.getElementById('preview-install').textContent = installGuide;

            // é¡¯ç¤ºä¸‹è¼‰å€
            document.getElementById('download-section').classList.remove('hidden');
        }

        // ç£ç¢Ÿç›¤é»ç”Ÿæˆå™¨
        function generateDiskAudit(name, desc) {
            const paths = document.getElementById('scanPaths').value || '$env:USERPROFILE\\Downloads\n$env:USERPROFILE\\Desktop';
            const largeMB = document.getElementById('largeFileMB').value || 500;
            const topN = document.getElementById('topN').value || 30;
            const optLarge = document.getElementById('optLargeFiles').checked;
            const optRecent = document.getElementById('optRecentFiles').checked;
            const optExt = document.getElementById('optExtStats').checked;
            const optDup = document.getElementById('optDuplicates').checked;

            const pathArray = paths.split('\n').filter(function(p) { return p.trim(); }).map(function(p) { return '"' + p.trim() + '"'; }).join(',\n        ');
            const pathList = paths.split('\n').filter(function(p) { return p.trim(); }).join(', ');
            const PSN = '`n';  // PowerShell newline

            // Build skillMd
            var skillMd = '# ' + name + '\n\n' + desc + '\n\n## åŠŸèƒ½\n';
            if (optLarge) skillMd += '- æ‰¾å‡ºå¤§æª”æ¡ˆï¼ˆTop ' + topN + 'ï¼‰\n';
            if (optRecent) skillMd += '- æœ€è¿‘ä¿®æ”¹æª”æ¡ˆï¼ˆTop ' + topN + 'ï¼‰\n';
            if (optExt) skillMd += '- å‰¯æª”åå®¹é‡çµ±è¨ˆ\n';
            if (optDup) skillMd += '- é‡è¤‡æª”æ¡ˆåµæ¸¬ï¼ˆSHA256ï¼‰\n';
            skillMd += '\n## è¨­å®š\n';
            skillMd += '- æƒæç¯„åœï¼š' + pathList + '\n';
            skillMd += '- å¤§æª”é–€æª»ï¼š' + largeMB + 'MB\n';
            skillMd += '- é¡¯ç¤ºæ•¸é‡ï¼šTop ' + topN + '\n\n';
            skillMd += '## ä½¿ç”¨æ–¹å¼\n';
            skillMd += 'è·Ÿé¾è¦èªªï¼šã€Œè·‘ç£ç¢Ÿç›¤é»ã€æˆ–ã€ŒåŸ·è¡Œ ' + name + 'ã€\n\n';
            skillMd += '## å ±å‘Šä½ç½®\n';
            skillMd += '~/.openclaw/workspace/reports/' + name + '/YYYY-MM-DD.md\n';

            // Build script
            var script = '# ' + name + ' - ' + desc + '\n';
            script += '# è‡ªå‹•ç”Ÿæˆæ–¼ ' + new Date().toLocaleDateString('zh-TW') + '\n\n';
            script += 'param(\n';
            script += '    [string[]]$ScanPaths = @(\n';
            script += '        ' + pathArray + '\n';
            script += '    ),\n';
            script += '    [int]$LargeFileMB = ' + largeMB + ',\n';
            script += '    [int]$TopN = ' + topN + '\n';
            script += ')\n\n';
            script += '$reportDate = Get-Date -Format "yyyy-MM-dd"\n';
            script += '$reportDir = "$env:USERPROFILE\\.openclaw\\workspace\\reports\\' + name + '"\n';
            script += 'if (!(Test-Path $reportDir)) { New-Item -ItemType Directory -Path $reportDir -Force }\n';
            script += '$reportPath = "$reportDir\\$reportDate.md"\n\n';
            script += '# æ’é™¤çš„ç³»çµ±è³‡æ–™å¤¾\n';
            script += '$excludeDirs = @("Windows", "Program Files", "Program Files (x86)",\n';
            script += "                 '\\$Recycle.Bin', \"node_modules\", \".git\", \"AppData\")\n\n";
            script += 'Write-Host "é–‹å§‹æƒæ..." -ForegroundColor Cyan\n';
            script += 'Write-Host "æƒæè·¯å¾‘: $($ScanPaths -join \', \')" -ForegroundColor Gray\n\n';
            script += '# å–å¾—æ‰€æœ‰æª”æ¡ˆ\n';
            script += '$allFiles = @()\n';
            script += 'foreach ($path in $ScanPaths) {\n';
            script += '    $expandedPath = $ExecutionContext.InvokeCommand.ExpandString($path)\n';
            script += '    if (Test-Path $expandedPath) {\n';
            script += '        Write-Host "æƒæä¸­: $expandedPath" -ForegroundColor Yellow\n';
            script += '        $allFiles += Get-ChildItem -Path $expandedPath -Recurse -File -ErrorAction SilentlyContinue |\n';
            script += '            Where-Object {\n';
            script += '                $dominated = $false\n';
            script += '                foreach ($ex in $excludeDirs) {\n';
            script += '                    if ($_.FullName -like "*\\$ex\\*") { $dominated = $true; break }\n';
            script += '                }\n';
            script += '                -not $dominated\n';
            script += '            }\n';
            script += '    } else {\n';
            script += '        Write-Host "è·¯å¾‘ä¸å­˜åœ¨: $expandedPath" -ForegroundColor Red\n';
            script += '    }\n';
            script += '}\n\n';
            script += 'Write-Host "æ‰¾åˆ° $($allFiles.Count) å€‹æª”æ¡ˆ" -ForegroundColor Green\n\n';
            script += '# ç”¢ç”Ÿå ±å‘Š\n';
            script += '$report = "# ç£ç¢Ÿç›¤é»å ±å‘Š - $reportDate' + PSN + PSN + '"\n';
            script += '$report += "æƒæè·¯å¾‘: $($ScanPaths -join \', \')' + PSN + '"\n';
            script += '$report += "æª”æ¡ˆç¸½æ•¸: $($allFiles.Count)' + PSN + PSN + '"\n\n';

            if (optLarge) {
                script += '# Top å¤§æª”æ¡ˆ\n';
                script += '$report += "## Top $TopN å¤§æª”æ¡ˆ' + PSN + PSN + '"\n';
                script += '$report += "| å¤§å° | æª”æ¡ˆè·¯å¾‘ |' + PSN + '"\n';
                script += '$report += "|------|----------|' + PSN + '"\n';
                script += '$largeFiles = $allFiles | Sort-Object Length -Descending | Select-Object -First $TopN\n';
                script += 'foreach ($f in $largeFiles) {\n';
                script += '    $sizeMB = [math]::Round($f.Length / 1MB, 2)\n';
                script += '    $report += "| $sizeMB MB | $($f.FullName) |' + PSN + '"\n';
                script += '}\n';
                script += '$report += "' + PSN + '"\n\n';
            }

            if (optRecent) {
                script += '# æœ€è¿‘ä¿®æ”¹\n';
                script += '$report += "## æœ€è¿‘ä¿®æ”¹ Top $TopN' + PSN + PSN + '"\n';
                script += '$report += "| ä¿®æ”¹æ™‚é–“ | æª”æ¡ˆè·¯å¾‘ |' + PSN + '"\n';
                script += '$report += "|----------|----------|' + PSN + '"\n';
                script += '$recentFiles = $allFiles | Sort-Object LastWriteTime -Descending | Select-Object -First $TopN\n';
                script += 'foreach ($f in $recentFiles) {\n';
                script += '    $time = $f.LastWriteTime.ToString("yyyy-MM-dd HH:mm")\n';
                script += '    $report += "| $time | $($f.FullName) |' + PSN + '"\n';
                script += '}\n';
                script += '$report += "' + PSN + '"\n\n';
            }

            if (optExt) {
                script += '# å‰¯æª”åçµ±è¨ˆ\n';
                script += '$report += "## å‰¯æª”åå®¹é‡çµ±è¨ˆ' + PSN + PSN + '"\n';
                script += '$report += "| å‰¯æª”å | ç¸½å®¹é‡ | æª”æ¡ˆæ•¸ |' + PSN + '"\n';
                script += '$report += "|--------|--------|--------|' + PSN + '"\n';
                script += '$extStats = $allFiles | Group-Object Extension | ForEach-Object {\n';
                script += '    [PSCustomObject]@{\n';
                script += '        Extension = if ($_.Name) { $_.Name } else { "(ç„¡å‰¯æª”å)" }\n';
                script += '        TotalSize = ($_.Group | Measure-Object Length -Sum).Sum\n';
                script += '        Count = $_.Count\n';
                script += '    }\n';
                script += '} | Sort-Object TotalSize -Descending | Select-Object -First $TopN\n';
                script += 'foreach ($ext in $extStats) {\n';
                script += '    $sizeMB = [math]::Round($ext.TotalSize / 1MB, 2)\n';
                script += '    $report += "| $($ext.Extension) | $sizeMB MB | $($ext.Count) |' + PSN + '"\n';
                script += '}\n';
                script += '$report += "' + PSN + '"\n\n';
            }

            if (optDup) {
                script += '# é‡è¤‡æª”æ¡ˆåµæ¸¬\n';
                script += '$report += "## å¯èƒ½çš„é‡è¤‡æª”æ¡ˆ' + PSN + PSN + '"\n';
                script += '$sizeGroups = $allFiles | Where-Object { $_.Length -gt 1MB } | Group-Object Length | Where-Object { $_.Count -gt 1 }\n';
                script += '$duplicates = @()\n';
                script += 'foreach ($group in $sizeGroups | Select-Object -First 30) {\n';
                script += '    $hashes = @{}\n';
                script += '    foreach ($file in $group.Group) {\n';
                script += '        try {\n';
                script += '            $hash = (Get-FileHash $file.FullName -Algorithm SHA256 -ErrorAction Stop).Hash\n';
                script += '            if ($hashes.ContainsKey($hash)) {\n';
                script += '                $duplicates += [PSCustomObject]@{\n';
                script += '                    Size = $file.Length\n';
                script += '                    File1 = $hashes[$hash]\n';
                script += '                    File2 = $file.FullName\n';
                script += '                }\n';
                script += '            } else {\n';
                script += '                $hashes[$hash] = $file.FullName\n';
                script += '            }\n';
                script += '        } catch { }\n';
                script += '    }\n';
                script += '}\n';
                script += 'if ($duplicates.Count -gt 0) {\n';
                script += '    foreach ($dup in $duplicates | Select-Object -First 20) {\n';
                script += '        $sizeMB = [math]::Round($dup.Size / 1MB, 2)\n';
                script += '        $report += "**[$sizeMB MB] é‡è¤‡:**' + PSN + '"\n';
                script += '        $report += "- $($dup.File1)' + PSN + '"\n';
                script += '        $report += "- $($dup.File2)' + PSN + PSN + '"\n';
                script += '    }\n';
                script += '} else {\n';
                script += '    $report += "æ²’æœ‰ç™¼ç¾é‡è¤‡æª”æ¡ˆã€‚' + PSN + '"\n';
                script += '}\n\n';
            }

            script += '# å„²å­˜å ±å‘Š\n';
            script += '$report | Out-File -FilePath $reportPath -Encoding UTF8\n';
            script += 'Write-Host "\\nå ±å‘Šå·²ç”¢ç”Ÿï¼š$reportPath" -ForegroundColor Green\n';
            script += 'Write-Host "å®Œæˆï¼" -ForegroundColor Cyan\n';

            return { skillMd: skillMd, script: script };
        }

        // Google Drive ä¸Šå‚³ç”Ÿæˆå™¨
        function generateGdriveUpload(name, desc) {
            const remoteFolder = document.getElementById('remoteFolder').value || 'OpenClaw-Uploads';
            const remoteName = document.getElementById('remoteName').value || 'gdrive';
            const autoLink = document.getElementById('optAutoLink').checked;

            const skillMd = '# ' + name + '\n\n' +
desc + '\n\n' +
'## åŠŸèƒ½\n' +
'- ä¸Šå‚³æª”æ¡ˆåˆ° Google Drive\n' +
'- ä¸Šå‚³åˆ°æŒ‡å®šè³‡æ–™å¤¾ï¼š' + remoteFolder + '\n' +
(autoLink ? '- è‡ªå‹•ç”¢ç”Ÿåˆ†äº«é€£çµ\n' : '') +
'\n## å‰ææ¢ä»¶\n' +
'- å·²å®‰è£ rclone\n' +
'- å·²å®Œæˆ Google Drive æˆæ¬Šï¼ˆrclone configï¼‰\n\n' +
'## ä½¿ç”¨æ–¹å¼\n' +
'è·Ÿé¾è¦èªªï¼šã€ŒæŠŠ xxx ä¸Šå‚³åˆ° Google Driveã€\n\n' +
'## æ‰‹å‹•åŸ·è¡Œ\n' +
FENCE + 'powershell\n' +
'& "~/.openclaw/workspace/skills/' + name + '/scripts/upload.ps1" -FilePath "C:\\\\path\\\\to\\\\file.zip"\n' +
FENCE + '\n';

            var script = '# ' + name + ' - ' + desc + '\n';
            script += '# è‡ªå‹•ç”Ÿæˆæ–¼ ' + new Date().toLocaleDateString('zh-TW') + '\n\n';
            script += 'param(\n';
            script += '    [Parameter(Mandatory=$true)]\n';
            script += '    [string]$FilePath,\n';
            script += '    [string]$RemoteFolder = "' + remoteFolder + '",\n';
            script += '    [string]$RemoteName = "' + remoteName + '"\n';
            script += ')\n\n';
            script += '# æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨\n';
            script += 'if (!(Test-Path $FilePath)) {\n';
            script += '    Write-Host "éŒ¯èª¤ï¼šæª”æ¡ˆä¸å­˜åœ¨ - $FilePath" -ForegroundColor Red\n';
            script += '    exit 1\n';
            script += '}\n\n';
            script += '$fileName = Split-Path $FilePath -Leaf\n\n';
            script += '# æª¢æŸ¥ rclone æ˜¯å¦å®‰è£\n';
            script += 'if (!(Get-Command rclone -ErrorAction SilentlyContinue)) {\n';
            script += '    Write-Host "éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° rcloneï¼Œè«‹å…ˆå®‰è£" -ForegroundColor Red\n';
            script += '    Write-Host "å®‰è£æŒ‡ä»¤ï¼šwinget install Rclone.Rclone" -ForegroundColor Yellow\n';
            script += '    exit 1\n';
            script += '}\n\n';
            script += '# ä¸Šå‚³æª”æ¡ˆ\n';
            script += 'Write-Host "æ­£åœ¨ä¸Šå‚³ $fileName åˆ° $RemoteName:$RemoteFolder ..." -ForegroundColor Cyan\n';
            script += 'rclone copy $FilePath "$RemoteName`:$RemoteFolder" --progress\n\n';
            script += 'if ($LASTEXITCODE -eq 0) {\n';
            script += '    Write-Host "ä¸Šå‚³æˆåŠŸï¼" -ForegroundColor Green\n';
            if (autoLink) {
                script += '    # ç”¢ç”Ÿåˆ†äº«é€£çµ\n';
                script += '    Write-Host "æ­£åœ¨ç”¢ç”Ÿåˆ†äº«é€£çµ..." -ForegroundColor Yellow\n';
                script += '    $link = rclone link "$RemoteName`:$RemoteFolder/$fileName"\n';
                script += '    if ($link) {\n';
                script += '        Write-Host "åˆ†äº«é€£çµï¼š" -ForegroundColor Cyan\n';
                script += '        Write-Host $link -ForegroundColor Green\n\n';
                script += '        # è¤‡è£½åˆ°å‰ªè²¼ç°¿\n';
                script += '        $link | Set-Clipboard\n';
                script += '        Write-Host "(å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿)" -ForegroundColor Gray\n';
                script += '    }\n';
            }
            script += '} else {\n';
            script += '    Write-Host "ä¸Šå‚³å¤±æ•—ï¼è«‹æª¢æŸ¥ rclone è¨­å®š" -ForegroundColor Red\n';
            script += '    exit 1\n';
            script += '}\n';

            return { skillMd: skillMd, script: script };
        }

        // ç¶²é çˆ¬èŸ²ç”Ÿæˆå™¨
        function generateWebScraper(name, desc) {
            const urls = document.getElementById('targetUrls').value || 'https://example.com';
            const mode = document.getElementById('scrapeMode').value;
            const selector = document.getElementById('cssSelector').value || '.content';
            const PSN = '`n';  // PowerShell newline

            const modeDesc = {
                'light': 'Light fetchï¼ˆè¼•é‡æŠ“å–ï¼‰',
                'dynamic': 'Dynamic JSï¼ˆç­‰å¾… JavaScriptï¼‰',
                'monitor': 'Scheduled monitorï¼ˆå®šæ™‚ç›£æ§ï¼‰'
            };

            const urlList = urls.split('\n').filter(function(u) { return u.trim(); }).map(function(u) { return '- ' + u.trim(); }).join('\n');
            const urlArray = urls.split('\n').filter(function(u) { return u.trim(); }).map(function(u) { return '"' + u.trim() + '"'; }).join(',\n        ');

            var skillMd = '# ' + name + '\n\n' +
desc + '\n\n' +
'## åŠŸèƒ½\n' +
'- æŠ“å–æŒ‡å®šç¶²é çš„è³‡æ–™\n' +
'- æ¨¡å¼ï¼š' + modeDesc[mode] + '\n' +
'- CSS é¸æ“‡å™¨ï¼š' + selector + '\n\n' +
'## ç›®æ¨™ç¶²å€\n' +
urlList + '\n\n' +
'## ä½¿ç”¨æ–¹å¼\n' +
'è·Ÿé¾è¦èªªï¼šã€ŒåŸ·è¡Œç¶²é çˆ¬èŸ²ã€æˆ–ã€ŒæŠ“å– xxx ç¶²ç«™ã€\n';

            var script = '# ' + name + ' - ' + desc + '\n';
            script += '# è‡ªå‹•ç”Ÿæˆæ–¼ ' + new Date().toLocaleDateString('zh-TW') + '\n';
            script += '# æ¨¡å¼ï¼š' + modeDesc[mode] + '\n\n';
            script += 'param(\n';
            script += '    [string[]]$Urls = @(\n';
            script += '        ' + urlArray + '\n';
            script += '    ),\n';
            script += '    [string]$Selector = "' + selector + '"\n';
            script += ')\n\n';
            script += '$reportDate = Get-Date -Format "yyyy-MM-dd_HHmmss"\n';
            script += '$reportDir = "$env:USERPROFILE\\.openclaw\\workspace\\reports\\' + name + '"\n';
            script += 'if (!(Test-Path $reportDir)) { New-Item -ItemType Directory -Path $reportDir -Force }\n';
            script += '$reportPath = "$reportDir\\$reportDate.md"\n\n';
            script += '$report = "# ç¶²é çˆ¬èŸ²å ±å‘Š - $reportDate' + PSN + PSN + '"\n\n';
            script += 'foreach ($url in $Urls) {\n';
            script += '    Write-Host "æŠ“å–ä¸­: $url" -ForegroundColor Cyan\n';
            script += '    $report += "## $url' + PSN + PSN + '"\n\n';
            script += '    try {\n';
            script += '        $response = Invoke-WebRequest -Uri $url -UseBasicParsing -TimeoutSec 30\n\n';
            script += '        # ç°¡æ˜“ HTML è§£æï¼ˆPowerShell å…§å»ºï¼‰\n';
            script += '        $content = $response.Content\n\n';
            script += '        # ç§»é™¤ script å’Œ style\n';
            script += "        $content = $content -replace '<script[^>]*>[\\s\\S]*?</script>', ''\n";
            script += "        $content = $content -replace '<style[^>]*>[\\s\\S]*?</style>', ''\n\n";
            script += '        # ç§»é™¤ HTML æ¨™ç±¤ï¼Œä¿ç•™æ–‡å­—\n';
            script += "        $text = $content -replace '<[^>]+>', ' '\n";
            script += "        $text = $text -replace '\\s+', ' '\n";
            script += '        $text = $text.Trim()\n\n';
            script += '        # å–å‰ 2000 å­—å…ƒ\n';
            script += '        if ($text.Length -gt 2000) {\n';
            script += '            $text = $text.Substring(0, 2000) + "..."\n';
            script += '        }\n\n';
            script += '        $report += "' + FENCE + PSN + '$text' + PSN + FENCE + PSN + PSN + '"\n';
            script += '        Write-Host "æˆåŠŸæŠ“å– $($text.Length) å­—å…ƒ" -ForegroundColor Green\n\n';
            script += '    } catch {\n';
            script += '        $report += "éŒ¯èª¤ï¼š$($_.Exception.Message)' + PSN + PSN + '"\n';
            script += '        Write-Host "æŠ“å–å¤±æ•—: $($_.Exception.Message)" -ForegroundColor Red\n';
            script += '    }\n';
            script += '}\n\n';
            script += '$report | Out-File -FilePath $reportPath -Encoding UTF8\n';
            script += 'Write-Host "\\nå ±å‘Šå·²ç”¢ç”Ÿï¼š$reportPath" -ForegroundColor Green\n';

            return { skillMd: skillMd, script: script };
        }

        // æ’ç¨‹æé†’ç”Ÿæˆå™¨
        function generateScheduler(name, desc) {
            const content = document.getElementById('reminderContent').value || 'é€™æ˜¯ä¸€å‰‡æé†’';
            const time = document.getElementById('scheduleTime').value || '09:00';
            const freq = document.getElementById('scheduleFreq').value;

            const freqDesc = {
                'daily': 'æ¯å¤©',
                'weekday': 'é€±ä¸€åˆ°é€±äº”',
                'weekly': 'æ¯é€±',
                'hourly': 'æ¯å°æ™‚'
            };

            const skillMd = '# ' + name + '\n\n' +
desc + '\n\n' +
'## æé†’å…§å®¹\n' +
content + '\n\n' +
'## æ’ç¨‹è¨­å®š\n' +
'- åŸ·è¡Œæ™‚é–“ï¼š' + time + '\n' +
'- é‡è¤‡é »ç‡ï¼š' + freqDesc[freq] + '\n\n' +
'## ä½¿ç”¨æ–¹å¼\n' +
'è·Ÿé¾è¦èªªï¼šã€Œè¨­å®šæé†’ã€æˆ–ã€ŒåŸ·è¡Œ ' + name + 'ã€\n\n' +
'## æ‰‹å‹•åŸ·è¡Œ\n' +
FENCE + 'powershell\n' +
'& "~/.openclaw/workspace/skills/' + name + '/scripts/remind.ps1"\n' +
FENCE + '\n';

            const script = '# ' + name + ' - ' + desc + '\n' +
'# è‡ªå‹•ç”Ÿæˆæ–¼ ' + new Date().toLocaleDateString('zh-TW') + '\n\n' +
'param(\n' +
'    [string]$Message = @"\n' +
content + '\n' +
'"@\n' +
')\n\n' +
'$timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"\n\n' +
'Write-Host "========================================" -ForegroundColor Cyan\n' +
'Write-Host "â° æé†’æ™‚é–“: $timestamp" -ForegroundColor Yellow\n' +
'Write-Host "========================================" -ForegroundColor Cyan\n' +
'Write-Host ""\n' +
'Write-Host $Message -ForegroundColor Green\n' +
'Write-Host ""\n' +
'Write-Host "========================================" -ForegroundColor Cyan\n\n' +
'# å¯é¸ï¼šç™¼é€ Windows é€šçŸ¥\n' +
'# [Windows.UI.Notifications.ToastNotificationManager, Windows.UI.Notifications, ContentType = WindowsRuntime] | Out-Null\n' +
'# é€™éœ€è¦é¡å¤–çš„è¨­å®šï¼Œæš«æ™‚ç”¨ Write-Host é¡¯ç¤º\n\n' +
'# è¨˜éŒ„åˆ°æ—¥èªŒ\n' +
'$logDir = "$env:USERPROFILE\\.openclaw\\workspace\\logs"\n' +
'if (!(Test-Path $logDir)) { New-Item -ItemType Directory -Path $logDir -Force }\n' +
'$logFile = "$logDir\\reminders.log"\n' +
'"$timestamp - $Message" | Out-File -FilePath $logFile -Append -Encoding UTF8\n';

            return { skillMd, script };
        }

        // æª”æ¡ˆæ•´ç†ç”Ÿæˆå™¨
        function generateFileOrganizer(name, desc) {
            const source = document.getElementById('sourceFolder').value || '$env:USERPROFILE\\Downloads';
            const rule = document.getElementById('organizeRule').value;
            const moveFiles = document.getElementById('optMoveFiles').checked;
            const PSN = '`n';  // PowerShell newline

            const ruleDesc = {
                'extension': 'ä¾å‰¯æª”ååˆ†é¡',
                'date': 'ä¾æ—¥æœŸåˆ†é¡',
                'size': 'ä¾å¤§å°åˆ†é¡'
            };

            var skillMd = '# ' + name + '\n\n' + desc + '\n\n';
            skillMd += '## åŠŸèƒ½\n';
            skillMd += '- æ•´ç†è¦å‰‡ï¼š' + ruleDesc[rule] + '\n';
            skillMd += '- ä¾†æºè³‡æ–™å¤¾ï¼š' + source + '\n';
            skillMd += '- æ¨¡å¼ï¼š' + (moveFiles ? 'ç§»å‹•æª”æ¡ˆ' : 'åªç”¢ç”Ÿå ±å‘Šï¼ˆä¸ç§»å‹•ï¼‰') + '\n\n';
            skillMd += '## ä½¿ç”¨æ–¹å¼\n';
            skillMd += 'è·Ÿé¾è¦èªªï¼šã€Œæ•´ç†ä¸‹è¼‰è³‡æ–™å¤¾ã€æˆ–ã€ŒåŸ·è¡Œ ' + name + 'ã€\n';

            var script = '# ' + name + ' - ' + desc + '\n';
            script += '# è‡ªå‹•ç”Ÿæˆæ–¼ ' + new Date().toLocaleDateString('zh-TW') + '\n';
            script += '# æ•´ç†è¦å‰‡ï¼š' + ruleDesc[rule] + '\n\n';
            script += 'param(\n';
            script += '    [string]$SourceFolder = "' + source + '",\n';
            script += '    [switch]$MoveFiles = $' + moveFiles + '\n';
            script += ')\n\n';
            script += '$expandedPath = $ExecutionContext.InvokeCommand.ExpandString($SourceFolder)\n\n';
            script += 'if (!(Test-Path $expandedPath)) {\n';
            script += '    Write-Host "éŒ¯èª¤ï¼šä¾†æºè³‡æ–™å¤¾ä¸å­˜åœ¨ - $expandedPath" -ForegroundColor Red\n';
            script += '    exit 1\n';
            script += '}\n\n';
            script += 'Write-Host "é–‹å§‹æ•´ç†: $expandedPath" -ForegroundColor Cyan\n';
            script += 'Write-Host "æ¨¡å¼: ' + (moveFiles ? 'ç§»å‹•æª”æ¡ˆ' : 'åªç”¢ç”Ÿå ±å‘Š') + '" -ForegroundColor Yellow\n\n';
            script += '$files = Get-ChildItem -Path $expandedPath -File\n\n';
            script += '$report = "# æª”æ¡ˆæ•´ç†å ±å‘Š - $(Get-Date -Format \'yyyy-MM-dd HH:mm\')' + PSN + PSN + '"\n';
            script += '$report += "ä¾†æºï¼š$expandedPath' + PSN + '"\n';
            script += '$report += "æª”æ¡ˆæ•¸ï¼š$($files.Count)' + PSN + PSN + '"\n\n';

            if (rule === 'extension') {
                script += '# ä¾å‰¯æª”ååˆ†é¡\n';
                script += '$groups = $files | Group-Object Extension\n';
                script += 'foreach ($group in $groups | Sort-Object Count -Descending) {\n';
                script += '    $ext = if ($group.Name) { $group.Name } else { "ç„¡å‰¯æª”å" }\n';
                script += '    $report += "## $ext ($($group.Count) å€‹æª”æ¡ˆ)' + PSN + '"\n';
                script += '    foreach ($file in $group.Group) {\n';
                script += '        $report += "- $($file.Name)' + PSN + '"\n';
                script += '        if ($MoveFiles) {\n';
                script += "            $destDir = Join-Path $expandedPath $ext.TrimStart('.')\n";
                script += '            if (!(Test-Path $destDir)) { New-Item -ItemType Directory -Path $destDir -Force | Out-Null }\n';
                script += '            Move-Item $file.FullName $destDir -Force\n';
                script += '        }\n';
                script += '    }\n';
                script += '    $report += "' + PSN + '"\n';
                script += '}\n\n';
            }

            if (rule === 'date') {
                script += '# ä¾æ—¥æœŸåˆ†é¡\n';
                script += '$groups = $files | Group-Object { $_.LastWriteTime.ToString("yyyy-MM") }\n';
                script += 'foreach ($group in $groups | Sort-Object Name -Descending) {\n';
                script += '    $report += "## $($group.Name) ($($group.Count) å€‹æª”æ¡ˆ)' + PSN + '"\n';
                script += '    foreach ($file in $group.Group) {\n';
                script += '        $report += "- $($file.Name)' + PSN + '"\n';
                script += '        if ($MoveFiles) {\n';
                script += '            $destDir = Join-Path $expandedPath $group.Name\n';
                script += '            if (!(Test-Path $destDir)) { New-Item -ItemType Directory -Path $destDir -Force | Out-Null }\n';
                script += '            Move-Item $file.FullName $destDir -Force\n';
                script += '        }\n';
                script += '    }\n';
                script += '    $report += "' + PSN + '"\n';
                script += '}\n\n';
            }

            if (rule === 'size') {
                script += '# ä¾å¤§å°åˆ†é¡\n';
                script += '$categories = @{\n';
                script += '    "01-å°æª”æ¡ˆ(å°æ–¼1MB)" = { $_.Length -lt 1MB }\n';
                script += '    "02-ä¸­æª”æ¡ˆ(1-100MB)" = { $_.Length -ge 1MB -and $_.Length -lt 100MB }\n';
                script += '    "03-å¤§æª”æ¡ˆ(100MB-1GB)" = { $_.Length -ge 100MB -and $_.Length -lt 1GB }\n';
                script += '    "04-è¶…å¤§æª”æ¡ˆ(å¤§æ–¼1GB)" = { $_.Length -ge 1GB }\n';
                script += '}\n';
                script += 'foreach ($cat in $categories.GetEnumerator() | Sort-Object Key) {\n';
                script += '    $catFiles = $files | Where-Object $cat.Value\n';
                script += '    if ($catFiles.Count -gt 0) {\n';
                script += '        $report += "## $($cat.Key) ($($catFiles.Count) å€‹æª”æ¡ˆ)' + PSN + '"\n';
                script += '        foreach ($file in $catFiles) {\n';
                script += '            $sizeMB = [math]::Round($file.Length / 1MB, 2)\n';
                script += '            $report += "- [$sizeMB MB] $($file.Name)' + PSN + '"\n';
                script += '            if ($MoveFiles) {\n';
                script += '                $destDir = Join-Path $expandedPath $cat.Key\n';
                script += '                if (!(Test-Path $destDir)) { New-Item -ItemType Directory -Path $destDir -Force | Out-Null }\n';
                script += '                Move-Item $file.FullName $destDir -Force\n';
                script += '            }\n';
                script += '        }\n';
                script += '        $report += "' + PSN + '"\n';
                script += '    }\n';
                script += '}\n\n';
            }

            script += '$reportDir = "$env:USERPROFILE\\.openclaw\\workspace\\reports\\' + name + '"\n';
            script += 'if (!(Test-Path $reportDir)) { New-Item -ItemType Directory -Path $reportDir -Force }\n';
            script += "$reportPath = \"$reportDir\\$(Get-Date -Format 'yyyy-MM-dd').md\"\n";
            script += '$report | Out-File -FilePath $reportPath -Encoding UTF8\n\n';
            script += 'Write-Host "\\nå ±å‘Šå·²ç”¢ç”Ÿï¼š$reportPath" -ForegroundColor Green\n';
            script += 'if ($MoveFiles) { Write-Host "æª”æ¡ˆå·²ç§»å‹•å®Œæˆï¼" -ForegroundColor Cyan }\n';

            return { skillMd: skillMd, script: script };
        }

        // è‡ªå‹•å‚™ä»½ç”Ÿæˆå™¨
        function generateBackup(name, desc) {
            const sources = document.getElementById('backupSources').value || '$env:USERPROFILE\\Documents';
            const dest = document.getElementById('backupDest').value || 'D:\\Backups';
            const mode = document.getElementById('backupMode').value;

            const modeDesc = {
                'copy': 'å®Œæ•´è¤‡è£½',
                'sync': 'åŒæ­¥',
                'incremental': 'å¢é‡å‚™ä»½'
            };

            const sourceList = sources.split('\n').filter(function(s) { return s.trim(); }).map(function(s) { return '  - ' + s.trim(); }).join('\n');
            const sourceArray = sources.split('\n').filter(function(s) { return s.trim(); }).map(function(s) { return '"' + s.trim() + '"'; }).join(',\n        ');

            var skillMd = '# ' + name + '\n\n' + desc + '\n\n';
            skillMd += '## è¨­å®š\n';
            skillMd += '- å‚™ä»½ä¾†æºï¼š\n';
            skillMd += sourceList + '\n';
            skillMd += '- å‚™ä»½ç›®çš„åœ°ï¼š' + dest + '\n';
            skillMd += '- å‚™ä»½æ¨¡å¼ï¼š' + modeDesc[mode] + '\n\n';
            skillMd += '## ä½¿ç”¨æ–¹å¼\n';
            skillMd += 'è·Ÿé¾è¦èªªï¼šã€ŒåŸ·è¡Œå‚™ä»½ã€æˆ–ã€Œå‚™ä»½æˆ‘çš„æª”æ¡ˆã€\n';

            var rcloneCmd = mode === 'sync' ? 'sync' : 'copy';

            var script = '# ' + name + ' - ' + desc + '\n';
            script += '# è‡ªå‹•ç”Ÿæˆæ–¼ ' + new Date().toLocaleDateString('zh-TW') + '\n';
            script += '# å‚™ä»½æ¨¡å¼ï¼š' + modeDesc[mode] + '\n\n';
            script += 'param(\n';
            script += '    [string[]]$Sources = @(\n';
            script += '        ' + sourceArray + '\n';
            script += '    ),\n';
            script += '    [string]$Destination = "' + dest + '"\n';
            script += ')\n\n';
            script += '$timestamp = Get-Date -Format "yyyy-MM-dd_HHmmss"\n';
            script += '$logDir = "$env:USERPROFILE\\.openclaw\\workspace\\logs"\n';
            script += 'if (!(Test-Path $logDir)) { New-Item -ItemType Directory -Path $logDir -Force }\n';
            script += '$logFile = "$logDir\\backup_$timestamp.log"\n\n';
            script += 'Write-Host "========================================" -ForegroundColor Cyan\n';
            script += 'Write-Host "é–‹å§‹å‚™ä»½ - $timestamp" -ForegroundColor Yellow\n';
            script += 'Write-Host "ç›®çš„åœ°: $Destination" -ForegroundColor Gray\n';
            script += 'Write-Host "========================================" -ForegroundColor Cyan\n\n';
            script += '"å‚™ä»½é–‹å§‹: $timestamp" | Out-File $logFile -Encoding UTF8\n\n';
            script += 'foreach ($source in $Sources) {\n';
            script += '    $expandedSource = $ExecutionContext.InvokeCommand.ExpandString($source)\n\n';
            script += '    if (!(Test-Path $expandedSource)) {\n';
            script += '        Write-Host "è·³éï¼ˆä¸å­˜åœ¨ï¼‰: $expandedSource" -ForegroundColor Yellow\n';
            script += '        "è·³é: $expandedSource (ä¸å­˜åœ¨)" | Out-File $logFile -Append -Encoding UTF8\n';
            script += '        continue\n';
            script += '    }\n\n';
            script += '    $folderName = Split-Path $expandedSource -Leaf\n';
            script += '    $destPath = if ($Destination -match ":") {\n';
            script += '        # å¦‚æœæ˜¯ rclone remoteï¼ˆå¦‚ gdrive:Backupsï¼‰\n';
            script += '        "$Destination/$folderName"\n';
            script += '    } else {\n';
            script += '        Join-Path $Destination $folderName\n';
            script += '    }\n\n';
            script += '    Write-Host "å‚™ä»½ä¸­: $expandedSource -> $destPath" -ForegroundColor Cyan\n\n';
            script += '    if ($Destination -match "^[a-zA-Z]+:") {\n';
            script += '        # ä½¿ç”¨ rcloneï¼ˆé›²ç«¯å‚™ä»½ï¼‰\n';
            script += '        rclone ' + rcloneCmd + ' "$expandedSource" "$destPath" --progress\n';
            script += '    } else {\n';
            script += '        # æœ¬æ©Ÿå‚™ä»½\n';
            script += '        if (!(Test-Path $destPath)) { New-Item -ItemType Directory -Path $destPath -Force | Out-Null }\n\n';
            script += '        $files = Get-ChildItem -Path $expandedSource -Recurse -File\n';
            script += '        $count = 0\n';
            script += '        foreach ($file in $files) {\n';
            script += '            $relativePath = $file.FullName.Substring($expandedSource.Length)\n';
            script += '            $targetPath = Join-Path $destPath $relativePath\n';
            script += '            $targetDir = Split-Path $targetPath -Parent\n';
            script += '            if (!(Test-Path $targetDir)) { New-Item -ItemType Directory -Path $targetDir -Force | Out-Null }\n';
            script += '            Copy-Item $file.FullName $targetPath -Force\n';
            script += '            $count++\n';
            script += '        }\n';
            script += '        Write-Host "å·²è¤‡è£½ $count å€‹æª”æ¡ˆ" -ForegroundColor Green\n';
            script += '    }\n\n';
            script += '    "å®Œæˆ: $expandedSource -> $destPath" | Out-File $logFile -Append -Encoding UTF8\n';
            script += '}\n\n';
            script += 'Write-Host "========================================" -ForegroundColor Cyan\n';
            script += 'Write-Host "å‚™ä»½å®Œæˆï¼" -ForegroundColor Green\n';
            script += 'Write-Host "æ—¥èªŒæª”: $logFile" -ForegroundColor Gray\n';
            script += '"å‚™ä»½å®Œæˆ: $(Get-Date -Format \'yyyy-MM-dd HH:mm:ss\')" | Out-File $logFile -Append -Encoding UTF8\n';

            return { skillMd: skillMd, script: script };
        }

        // è‡ªè¨‚ Skill ç”Ÿæˆå™¨
        function generateCustom(name, desc) {
            const trigger = document.getElementById('customTrigger').value || 'åŸ·è¡Œæˆ‘çš„ä»»å‹™';
            const userScript = document.getElementById('customScript').value || 'Write-Host "Hello from my custom skill!"';

            const skillMd = '# ' + name + '\n\n' +
desc + '\n\n' +
'## è§¸ç™¼æŒ‡ä»¤\n' +
'è·Ÿé¾è¦èªªï¼šã€Œ' + trigger + 'ã€\n\n' +
'## åŠŸèƒ½èªªæ˜\n' +
'è‡ªè¨‚æŠ€èƒ½ï¼ŒåŸ·è¡Œä»¥ä¸‹è…³æœ¬ã€‚\n\n' +
'## ä½¿ç”¨æ–¹å¼\n' +
FENCE + '\n' +
trigger + '\n' +
FENCE + '\n';

            const fullScript = '# ' + name + ' - ' + desc + '\n' +
'# è‡ªå‹•ç”Ÿæˆæ–¼ ' + new Date().toLocaleDateString('zh-TW') + '\n' +
'# è§¸ç™¼æŒ‡ä»¤ï¼š' + trigger + '\n\n' +
userScript + '\n';

            return { skillMd, script: fullScript };
        }

        // ä¸‹è¼‰å–®ä¸€æª”æ¡ˆ
        function downloadFile(type) {
            if (!generatedFiles[type]) {
                alert('è«‹å…ˆç”Ÿæˆ Skillï¼');
                return;
            }

            const file = generatedFiles[type];
            const blob = new Blob([file.content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = file.filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ä¸‹è¼‰å…¨éƒ¨ï¼ˆæ¨¡æ“¬ ZIPï¼Œå¯¦éš›ä¸Šåˆ†åˆ¥ä¸‹è¼‰ï¼‰
        function downloadAll() {
            // ç”±æ–¼ç´”å‰ç«¯é›£ä»¥å»ºç«‹çœŸæ­£çš„ ZIPï¼Œæ”¹ç‚ºé€ä¸€ä¸‹è¼‰
            downloadFile('skill-md');
            setTimeout(() => downloadFile('script'), 500);
            setTimeout(() => downloadFile('install'), 1000);
        }

        // åˆå§‹åŒ–
        updateDefaultName();
    </script>
</body>
</html>
