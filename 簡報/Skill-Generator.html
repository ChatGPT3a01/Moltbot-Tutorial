<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenClaw Skill ç”Ÿæˆå™¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .header h1 { font-size: 42px; margin-bottom: 10px; text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .header p { font-size: 18px; opacity: 0.9; }

        .nav-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .nav-link {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }
        .nav-link:hover { background: rgba(255,255,255,0.4); }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        @media (max-width: 1000px) {
            .main-grid { grid-template-columns: 1fr; }
        }

        .panel {
            background: rgba(255,255,255,0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .panel h2 {
            color: #667eea;
            font-size: 24px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 15px;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .form-group small {
            display: block;
            color: #888;
            margin-top: 5px;
            font-size: 13px;
        }

        .template-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
        }
        .template-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .template-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .template-card.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }
        .template-card .icon { font-size: 32px; margin-bottom: 8px; }
        .template-card .name { font-size: 13px; font-weight: 600; }

        .btn {
            display: inline-block;
            padding: 14px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(102,126,234,0.4);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102,126,234,0.5);
        }
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        .btn-success:hover {
            transform: translateY(-2px);
        }
        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .preview-section {
            margin-top: 20px;
        }
        .preview-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        .preview-tab {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }
        .preview-tab.active {
            background: #1e1e1e;
            color: #fff;
        }
        .preview-content {
            background: #1e1e1e;
            border-radius: 0 12px 12px 12px;
            padding: 20px;
            max-height: 400px;
            overflow: auto;
        }
        .preview-content pre {
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            margin: 0;
        }
        .preview-content .comment { color: #6a9955; }
        .preview-content .keyword { color: #569cd6; }
        .preview-content .string { color: #ce9178; }
        .preview-content .variable { color: #9cdcfe; }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr; }
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
        }
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .checkbox-group label {
            cursor: pointer;
            font-size: 14px;
            margin: 0;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin: 20px 0;
            font-size: 14px;
            color: #0d47a1;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin: 20px 0;
            color: #155724;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš¡ OpenClaw Skill ç”Ÿæˆå™¨</h1>
            <p>è‡ªè¨‚ä½ çš„é¾è¦æŠ€èƒ½ï¼Œä¸€éµä¸‹è¼‰ä½¿ç”¨</p>
            <div class="nav-links">
                <a href="index.html" class="nav-link">ğŸ  é¦–é </a>
                <a href="Skill-DiskAudit.html" class="nav-link">ğŸ“ ç£ç¢Ÿç›¤é»æ•™å­¸</a>
                <a href="Skill-GoogleDrive.html" class="nav-link">â˜ï¸ é›²ç«¯ä¸Šå‚³æ•™å­¸</a>
                <a href="Skill-BrowserRelay.html" class="nav-link">ğŸŒ ç¶²é æ“ä½œæ•™å­¸</a>
            </div>
        </div>

        <div class="main-grid">
            <!-- å·¦å´ï¼šè¨­å®šé¢æ¿ -->
            <div class="panel">
                <h2>ğŸ“ ç¬¬ä¸€æ­¥ï¼šé¸æ“‡ Skill é¡å‹</h2>
                <div class="template-cards">
                    <div class="template-card selected" data-template="disk-audit">
                        <div class="icon">ğŸ“</div>
                        <div class="name">ç£ç¢Ÿç›¤é»</div>
                    </div>
                    <div class="template-card" data-template="gdrive-upload">
                        <div class="icon">â˜ï¸</div>
                        <div class="name">é›²ç«¯ä¸Šå‚³</div>
                    </div>
                    <div class="template-card" data-template="web-scraper">
                        <div class="icon">ğŸ•·ï¸</div>
                        <div class="name">ç¶²é çˆ¬èŸ²</div>
                    </div>
                    <div class="template-card" data-template="scheduler">
                        <div class="icon">â°</div>
                        <div class="name">æ’ç¨‹æé†’</div>
                    </div>
                    <div class="template-card" data-template="file-organizer">
                        <div class="icon">ğŸ“‚</div>
                        <div class="name">æª”æ¡ˆæ•´ç†</div>
                    </div>
                    <div class="template-card" data-template="backup">
                        <div class="icon">ğŸ’¾</div>
                        <div class="name">è‡ªå‹•å‚™ä»½</div>
                    </div>
                    <div class="template-card" data-template="custom">
                        <div class="icon">ğŸ”§</div>
                        <div class="name">è‡ªè¨‚ Skill</div>
                    </div>
                </div>

                <h2>âš™ï¸ ç¬¬äºŒæ­¥ï¼šè‡ªè¨‚è¨­å®š</h2>

                <div class="form-group">
                    <label>Skill åç¨±</label>
                    <input type="text" id="skillName" placeholder="ä¾‹å¦‚ï¼šmy-disk-audit">
                    <small>åªèƒ½ç”¨è‹±æ–‡ã€æ•¸å­—å’Œé€£å­—è™Ÿ</small>
                </div>

                <div class="form-group">
                    <label>Skill èªªæ˜</label>
                    <input type="text" id="skillDescription" placeholder="ä¾‹å¦‚ï¼šè‡ªå‹•ç›¤é»ç£ç¢Ÿä¸¦ç”¢ç”Ÿå ±å‘Š">
                </div>

                <!-- ç£ç¢Ÿç›¤é»é¸é … -->
                <div id="options-disk-audit" class="template-options">
                    <div class="form-group">
                        <label>æƒæè·¯å¾‘ï¼ˆæ¯è¡Œä¸€å€‹ï¼‰</label>
                        <textarea id="scanPaths" placeholder="C:\Users\user\Downloads&#10;C:\Users\user\Desktop&#10;D:\Documents"></textarea>
                    </div>
                    <div class="options-grid">
                        <div class="form-group">
                            <label>å¤§æª”é–€æª» (MB)</label>
                            <input type="number" id="largeFileMB" value="500" min="1">
                        </div>
                        <div class="form-group">
                            <label>é¡¯ç¤ºå‰å¹¾å</label>
                            <input type="number" id="topN" value="30" min="1" max="100">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>åŠŸèƒ½é¸é …</label>
                        <div class="options-grid">
                            <div class="checkbox-group">
                                <input type="checkbox" id="optLargeFiles" checked>
                                <label for="optLargeFiles">æ‰¾å¤§æª”æ¡ˆ</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="optRecentFiles" checked>
                                <label for="optRecentFiles">æœ€è¿‘ä¿®æ”¹</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="optExtStats" checked>
                                <label for="optExtStats">å‰¯æª”åçµ±è¨ˆ</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="optDuplicates">
                                <label for="optDuplicates">é‡è¤‡æª”åµæ¸¬</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- é›²ç«¯ä¸Šå‚³é¸é … -->
                <div id="options-gdrive-upload" class="template-options hidden">
                    <div class="form-group">
                        <label>é ç«¯è³‡æ–™å¤¾åç¨±</label>
                        <input type="text" id="remoteFolder" value="OpenClaw-Uploads">
                    </div>
                    <div class="form-group">
                        <label>rclone Remote åç¨±</label>
                        <input type="text" id="remoteName" value="gdrive">
                        <small>é è¨­æ˜¯ gdriveï¼Œé™¤éä½ åœ¨ rclone config ç”¨äº†å…¶ä»–åå­—</small>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="optAutoLink" checked>
                        <label for="optAutoLink">è‡ªå‹•ç”¢ç”Ÿåˆ†äº«é€£çµ</label>
                    </div>
                </div>

                <!-- ç¶²é çˆ¬èŸ²é¸é … -->
                <div id="options-web-scraper" class="template-options hidden">
                    <div class="form-group">
                        <label>ç›®æ¨™ç¶²å€ï¼ˆæ¯è¡Œä¸€å€‹ï¼‰</label>
                        <textarea id="targetUrls" placeholder="https://example.com/news&#10;https://example.com/prices"></textarea>
                    </div>
                    <div class="form-group">
                        <label>çˆ¬èŸ²æ¨¡å¼</label>
                        <select id="scrapeMode">
                            <option value="light">Light fetchï¼ˆè¼•é‡ï¼Œç´” HTMLï¼‰</option>
                            <option value="dynamic">Dynamic JSï¼ˆç­‰ JavaScript è¼‰å…¥ï¼‰</option>
                            <option value="monitor">Scheduled monitorï¼ˆå®šæ™‚ç›£æ§è®ŠåŒ–ï¼‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>è¦æŠ“å–çš„è³‡æ–™ï¼ˆCSS é¸æ“‡å™¨ï¼‰</label>
                        <input type="text" id="cssSelector" placeholder="ä¾‹å¦‚ï¼š.news-title, #price, article h2">
                    </div>
                </div>

                <!-- æ’ç¨‹æé†’é¸é … -->
                <div id="options-scheduler" class="template-options hidden">
                    <div class="form-group">
                        <label>æé†’å…§å®¹</label>
                        <textarea id="reminderContent" placeholder="ä¾‹å¦‚ï¼šè©²å–æ°´äº†ï¼&#10;è¨˜å¾—ç«™èµ·ä¾†èµ°å‹•ä¸€ä¸‹"></textarea>
                    </div>
                    <div class="options-grid">
                        <div class="form-group">
                            <label>åŸ·è¡Œæ™‚é–“</label>
                            <input type="time" id="scheduleTime" value="09:00">
                        </div>
                        <div class="form-group">
                            <label>é‡è¤‡é »ç‡</label>
                            <select id="scheduleFreq">
                                <option value="daily">æ¯å¤©</option>
                                <option value="weekday">é€±ä¸€åˆ°é€±äº”</option>
                                <option value="weekly">æ¯é€±</option>
                                <option value="hourly">æ¯å°æ™‚</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- æª”æ¡ˆæ•´ç†é¸é … -->
                <div id="options-file-organizer" class="template-options hidden">
                    <div class="form-group">
                        <label>ä¾†æºè³‡æ–™å¤¾</label>
                        <input type="text" id="sourceFolder" placeholder="C:\Users\user\Downloads">
                    </div>
                    <div class="form-group">
                        <label>æ•´ç†è¦å‰‡</label>
                        <select id="organizeRule">
                            <option value="extension">ä¾å‰¯æª”ååˆ†é¡</option>
                            <option value="date">ä¾æ—¥æœŸåˆ†é¡</option>
                            <option value="size">ä¾å¤§å°åˆ†é¡</option>
                        </select>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="optMoveFiles">
                        <label for="optMoveFiles">ç§»å‹•æª”æ¡ˆï¼ˆä¸å‹¾é¸å‰‡åªç”¢ç”Ÿå ±å‘Šï¼‰</label>
                    </div>
                </div>

                <!-- è‡ªå‹•å‚™ä»½é¸é … -->
                <div id="options-backup" class="template-options hidden">
                    <div class="form-group">
                        <label>å‚™ä»½ä¾†æºï¼ˆæ¯è¡Œä¸€å€‹ï¼‰</label>
                        <textarea id="backupSources" placeholder="C:\Users\user\Documents&#10;C:\Users\user\Pictures"></textarea>
                    </div>
                    <div class="form-group">
                        <label>å‚™ä»½ç›®çš„åœ°</label>
                        <input type="text" id="backupDest" placeholder="D:\Backups æˆ– gdrive:Backups">
                    </div>
                    <div class="form-group">
                        <label>å‚™ä»½æ¨¡å¼</label>
                        <select id="backupMode">
                            <option value="copy">å®Œæ•´è¤‡è£½</option>
                            <option value="sync">åŒæ­¥ï¼ˆåˆªé™¤ç›®çš„åœ°å¤šé¤˜æª”æ¡ˆï¼‰</option>
                            <option value="incremental">å¢é‡å‚™ä»½</option>
                        </select>
                    </div>
                </div>

                <!-- è‡ªè¨‚ Skill é¸é … -->
                <div id="options-custom" class="template-options hidden">
                    <div class="form-group">
                        <label>è§¸ç™¼æŒ‡ä»¤</label>
                        <input type="text" id="customTrigger" placeholder="ä¾‹å¦‚ï¼šåŸ·è¡Œæˆ‘çš„ä»»å‹™">
                        <small>è·Ÿé¾è¦èªªé€™å¥è©±å°±æœƒåŸ·è¡Œæ­¤ Skill</small>
                    </div>
                    <div class="form-group">
                        <label>è‡ªè¨‚è…³æœ¬å…§å®¹ (PowerShell)</label>
                        <textarea id="customScript" style="min-height:150px; font-family: Consolas, monospace;" placeholder="# åœ¨é€™è£¡å¯«ä½ çš„ PowerShell è…³æœ¬&#10;Write-Host &quot;Hello from my skill!&quot;"></textarea>
                    </div>
                </div>

                <div class="info-box">
                    ğŸ’¡ <strong>æç¤ºï¼š</strong>ç”Ÿæˆå¾Œçš„æª”æ¡ˆéœ€è¦æ”¾åˆ° <code>~/.openclaw/workspace/skills/ä½ çš„skillåç¨±/</code> è³‡æ–™å¤¾
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="generateSkill()">âš¡ ç”Ÿæˆ Skill</button>
                </div>
            </div>

            <!-- å³å´ï¼šé è¦½èˆ‡ä¸‹è¼‰ -->
            <div class="panel">
                <h2>ğŸ‘€ ç¬¬ä¸‰æ­¥ï¼šé è¦½èˆ‡ä¸‹è¼‰</h2>

                <div class="preview-section">
                    <div class="preview-tabs">
                        <button class="preview-tab active" data-tab="skill-md">SKILL.md</button>
                        <button class="preview-tab" data-tab="script">è…³æœ¬æª”æ¡ˆ</button>
                        <button class="preview-tab" data-tab="install">å®‰è£èªªæ˜</button>
                    </div>
                    <div class="preview-content">
                        <pre id="preview-skill-md"># è«‹å…ˆåœ¨å·¦å´é¸æ“‡ Skill é¡å‹ä¸¦å¡«å¯«è¨­å®š</pre>
                        <pre id="preview-script" class="hidden"># è…³æœ¬é è¦½æœƒé¡¯ç¤ºåœ¨é€™è£¡</pre>
                        <pre id="preview-install" class="hidden"># å®‰è£èªªæ˜æœƒé¡¯ç¤ºåœ¨é€™è£¡</pre>
                    </div>
                </div>

                <div id="download-section" class="hidden">
                    <div class="success-box">
                        âœ… Skill å·²ç”Ÿæˆï¼é»æ“Šä¸‹æ–¹æŒ‰éˆ•ä¸‹è¼‰æª”æ¡ˆã€‚
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="downloadFile('skill-md')">ğŸ“„ ä¸‹è¼‰ SKILL.md</button>
                        <button class="btn btn-success" onclick="downloadFile('script')">ğŸ“œ ä¸‹è¼‰è…³æœ¬</button>
                        <button class="btn btn-primary" onclick="downloadAll()">ğŸ“¦ ä¸‹è¼‰å…¨éƒ¨ (ZIP)</button>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 30px;">
                    <strong>ğŸ“‚ å®‰è£ä½ç½®ï¼š</strong><br>
                    <code>C:\Users\ä½ çš„ä½¿ç”¨è€…åç¨±\.openclaw\workspace\skills\[skillåç¨±]\</code><br><br>
                    <strong>ğŸ“ è³‡æ–™å¤¾çµæ§‹ï¼š</strong><br>
                    <code>
                    skills/<br>
                    â””â”€â”€ [skillåç¨±]/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€â”€ SKILL.md<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;â””â”€â”€ scripts/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â””â”€â”€ run.ps1
                    </code>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç•¶å‰é¸æ“‡çš„æ¨¡æ¿
        let currentTemplate = 'disk-audit';
        let generatedFiles = {};

        // æ¨¡æ¿å¡ç‰‡é»æ“Š
        document.querySelectorAll('.template-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                currentTemplate = card.dataset.template;

                // é¡¯ç¤ºå°æ‡‰çš„é¸é …
                document.querySelectorAll('.template-options').forEach(opt => opt.classList.add('hidden'));
                const optPanel = document.getElementById('options-' + currentTemplate);
                if (optPanel) optPanel.classList.remove('hidden');

                // æ›´æ–°é è¨­åç¨±
                updateDefaultName();
            });
        });

        // é è¦½ Tab åˆ‡æ›
        document.querySelectorAll('.preview-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.preview-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                const tabName = tab.dataset.tab;
                document.querySelectorAll('.preview-content pre').forEach(pre => pre.classList.add('hidden'));
                document.getElementById('preview-' + tabName).classList.remove('hidden');
            });
        });

        // æ›´æ–°é è¨­åç¨±
        function updateDefaultName() {
            const nameInput = document.getElementById('skillName');
            const descInput = document.getElementById('skillDescription');

            const defaults = {
                'disk-audit': { name: 'disk-audit', desc: 'ç£ç¢Ÿå¸¸æ…‹ç›¤é»/æ•´ç†å·¥å…·' },
                'gdrive-upload': { name: 'gdrive-upload', desc: 'ä¸Šå‚³æª”æ¡ˆåˆ° Google Drive' },
                'web-scraper': { name: 'web-scraper', desc: 'ç¶²é çˆ¬èŸ²æŠ“å–è³‡æ–™' },
                'scheduler': { name: 'daily-reminder', desc: 'æ¯æ—¥æ’ç¨‹æé†’' },
                'file-organizer': { name: 'file-organizer', desc: 'è‡ªå‹•æ•´ç†æª”æ¡ˆ' },
                'backup': { name: 'auto-backup', desc: 'è‡ªå‹•å‚™ä»½é‡è¦è³‡æ–™' },
                'custom': { name: 'my-custom-skill', desc: 'æˆ‘çš„è‡ªè¨‚æŠ€èƒ½' }
            };

            if (defaults[currentTemplate]) {
                nameInput.placeholder = defaults[currentTemplate].name;
                descInput.placeholder = defaults[currentTemplate].desc;
            }
        }

        // ç”Ÿæˆ Skill
        function generateSkill() {
            const skillName = document.getElementById('skillName').value || document.getElementById('skillName').placeholder;
            const skillDesc = document.getElementById('skillDescription').value || document.getElementById('skillDescription').placeholder;

            let skillMd = '';
            let script = '';
            let installGuide = '';
            let scriptFileName = 'run.ps1';

            switch (currentTemplate) {
                case 'disk-audit':
                    const result = generateDiskAudit(skillName, skillDesc);
                    skillMd = result.skillMd;
                    script = result.script;
                    scriptFileName = 'scan.ps1';
                    break;
                case 'gdrive-upload':
                    const gdriveResult = generateGdriveUpload(skillName, skillDesc);
                    skillMd = gdriveResult.skillMd;
                    script = gdriveResult.script;
                    scriptFileName = 'upload.ps1';
                    break;
                case 'web-scraper':
                    const scraperResult = generateWebScraper(skillName, skillDesc);
                    skillMd = scraperResult.skillMd;
                    script = scraperResult.script;
                    scriptFileName = 'scrape.ps1';
                    break;
                case 'scheduler':
                    const schedResult = generateScheduler(skillName, skillDesc);
                    skillMd = schedResult.skillMd;
                    script = schedResult.script;
                    scriptFileName = 'remind.ps1';
                    break;
                case 'file-organizer':
                    const orgResult = generateFileOrganizer(skillName, skillDesc);
                    skillMd = orgResult.skillMd;
                    script = orgResult.script;
                    scriptFileName = 'organize.ps1';
                    break;
                case 'backup':
                    const backupResult = generateBackup(skillName, skillDesc);
                    skillMd = backupResult.skillMd;
                    script = backupResult.script;
                    scriptFileName = 'backup.ps1';
                    break;
                case 'custom':
                    const customResult = generateCustom(skillName, skillDesc);
                    skillMd = customResult.skillMd;
                    script = customResult.script;
                    break;
            }

            // å®‰è£èªªæ˜
            installGuide = `# ${skillName} å®‰è£èªªæ˜

## 1. å»ºç«‹è³‡æ–™å¤¾
åœ¨ PowerShell åŸ·è¡Œï¼š
\`\`\`powershell
mkdir "$env:USERPROFILE\\.openclaw\\workspace\\skills\\${skillName}\\scripts" -Force
\`\`\`

## 2. æ”¾ç½®æª”æ¡ˆ
- æŠŠ \`SKILL.md\` æ”¾åˆ° \`~/.openclaw/workspace/skills/${skillName}/\`
- æŠŠ \`${scriptFileName}\` æ”¾åˆ° \`~/.openclaw/workspace/skills/${skillName}/scripts/\`

## 3. ä½¿ç”¨æ–¹å¼
è·Ÿé¾è¦èªªï¼šã€ŒåŸ·è¡Œ ${skillName}ã€æˆ–ã€Œè·‘${skillDesc}ã€

## è³‡æ–™å¤¾çµæ§‹
\`\`\`
.openclaw/
â””â”€â”€ workspace/
    â””â”€â”€ skills/
        â””â”€â”€ ${skillName}/
            â”œâ”€â”€ SKILL.md
            â””â”€â”€ scripts/
                â””â”€â”€ ${scriptFileName}
\`\`\`
`;

            // å„²å­˜ç”Ÿæˆçš„æª”æ¡ˆ
            generatedFiles = {
                'skill-md': { content: skillMd, filename: 'SKILL.md' },
                'script': { content: script, filename: scriptFileName },
                'install': { content: installGuide, filename: 'INSTALL.md' }
            };

            // æ›´æ–°é è¦½
            document.getElementById('preview-skill-md').textContent = skillMd;
            document.getElementById('preview-script').textContent = script;
            document.getElementById('preview-install').textContent = installGuide;

            // é¡¯ç¤ºä¸‹è¼‰å€
            document.getElementById('download-section').classList.remove('hidden');
        }

        // ç£ç¢Ÿç›¤é»ç”Ÿæˆå™¨
        function generateDiskAudit(name, desc) {
            const paths = document.getElementById('scanPaths').value || '$env:USERPROFILE\\Downloads\n$env:USERPROFILE\\Desktop';
            const largeMB = document.getElementById('largeFileMB').value || 500;
            const topN = document.getElementById('topN').value || 30;
            const optLarge = document.getElementById('optLargeFiles').checked;
            const optRecent = document.getElementById('optRecentFiles').checked;
            const optExt = document.getElementById('optExtStats').checked;
            const optDup = document.getElementById('optDuplicates').checked;

            const pathArray = paths.split('\n').filter(p => p.trim()).map(p => `"${p.trim()}"`).join(',\n        ');

            const skillMd = `# ${name}

${desc}

## åŠŸèƒ½
${optLarge ? '- æ‰¾å‡ºå¤§æª”æ¡ˆï¼ˆTop ' + topN + 'ï¼‰\n' : ''}${optRecent ? '- æœ€è¿‘ä¿®æ”¹æª”æ¡ˆï¼ˆTop ' + topN + 'ï¼‰\n' : ''}${optExt ? '- å‰¯æª”åå®¹é‡çµ±è¨ˆ\n' : ''}${optDup ? '- é‡è¤‡æª”æ¡ˆåµæ¸¬ï¼ˆSHA256ï¼‰\n' : ''}
## è¨­å®š
- æƒæç¯„åœï¼š${paths.split('\n').filter(p => p.trim()).join(', ')}
- å¤§æª”é–€æª»ï¼š${largeMB}MB
- é¡¯ç¤ºæ•¸é‡ï¼šTop ${topN}

## ä½¿ç”¨æ–¹å¼
è·Ÿé¾è¦èªªï¼šã€Œè·‘ç£ç¢Ÿç›¤é»ã€æˆ–ã€ŒåŸ·è¡Œ ${name}ã€

## å ±å‘Šä½ç½®
~/.openclaw/workspace/reports/${name}/YYYY-MM-DD.md
`;

            const script = `# ${name} - ${desc}
# è‡ªå‹•ç”Ÿæˆæ–¼ ${new Date().toLocaleDateString('zh-TW')}

param(
    [string[]]$ScanPaths = @(
        ${pathArray}
    ),
    [int]$LargeFileMB = ${largeMB},
    [int]$TopN = ${topN}
)

$reportDate = Get-Date -Format "yyyy-MM-dd"
$reportDir = "$env:USERPROFILE\\.openclaw\\workspace\\reports\\${name}"
if (!(Test-Path $reportDir)) { New-Item -ItemType Directory -Path $reportDir -Force }
$reportPath = "$reportDir\\$reportDate.md"

# æ’é™¤çš„ç³»çµ±è³‡æ–™å¤¾
$excludeDirs = @("Windows", "Program Files", "Program Files (x86)",
                 '\$Recycle.Bin', "node_modules", ".git", "AppData")

Write-Host "é–‹å§‹æƒæ..." -ForegroundColor Cyan
Write-Host "æƒæè·¯å¾‘: $($ScanPaths -join ', ')" -ForegroundColor Gray

# å–å¾—æ‰€æœ‰æª”æ¡ˆ
$allFiles = @()
foreach ($path in $ScanPaths) {
    $expandedPath = $ExecutionContext.InvokeCommand.ExpandString($path)
    if (Test-Path $expandedPath) {
        Write-Host "æƒæä¸­: $expandedPath" -ForegroundColor Yellow
        $allFiles += Get-ChildItem -Path $expandedPath -Recurse -File -ErrorAction SilentlyContinue |
            Where-Object {
                $dominated = $false
                foreach ($ex in $excludeDirs) {
                    if ($_.FullName -like "*\\$ex\\*") { $dominated = $true; break }
                }
                -not $dominated
            }
    } else {
        Write-Host "è·¯å¾‘ä¸å­˜åœ¨: $expandedPath" -ForegroundColor Red
    }
}

Write-Host "æ‰¾åˆ° $($allFiles.Count) å€‹æª”æ¡ˆ" -ForegroundColor Green

# ç”¢ç”Ÿå ±å‘Š
$report = "# ç£ç¢Ÿç›¤é»å ±å‘Š - $reportDate\`n\`n"
$report += "æƒæè·¯å¾‘: $($ScanPaths -join ', ')\`n"
$report += "æª”æ¡ˆç¸½æ•¸: $($allFiles.Count)\`n\`n"

${optLarge ? `# Top å¤§æª”æ¡ˆ
$report += "## Top $TopN å¤§æª”æ¡ˆ\`n\`n"
$report += "| å¤§å° | æª”æ¡ˆè·¯å¾‘ |\`n"
$report += "|------|----------|\`n"
$largeFiles = $allFiles | Sort-Object Length -Descending | Select-Object -First $TopN
foreach ($f in $largeFiles) {
    $sizeMB = [math]::Round($f.Length / 1MB, 2)
    $report += "| $sizeMB MB | $($f.FullName) |\`n"
}
$report += "\`n"
` : ''}
${optRecent ? `# æœ€è¿‘ä¿®æ”¹
$report += "## æœ€è¿‘ä¿®æ”¹ Top $TopN\`n\`n"
$report += "| ä¿®æ”¹æ™‚é–“ | æª”æ¡ˆè·¯å¾‘ |\`n"
$report += "|----------|----------|\`n"
$recentFiles = $allFiles | Sort-Object LastWriteTime -Descending | Select-Object -First $TopN
foreach ($f in $recentFiles) {
    $time = $f.LastWriteTime.ToString("yyyy-MM-dd HH:mm")
    $report += "| $time | $($f.FullName) |\`n"
}
$report += "\`n"
` : ''}
${optExt ? `# å‰¯æª”åçµ±è¨ˆ
$report += "## å‰¯æª”åå®¹é‡çµ±è¨ˆ\`n\`n"
$report += "| å‰¯æª”å | ç¸½å®¹é‡ | æª”æ¡ˆæ•¸ |\`n"
$report += "|--------|--------|--------|\`n"
$extStats = $allFiles | Group-Object Extension | ForEach-Object {
    [PSCustomObject]@{
        Extension = if ($_.Name) { $_.Name } else { "(ç„¡å‰¯æª”å)" }
        TotalSize = ($_.Group | Measure-Object Length -Sum).Sum
        Count = $_.Count
    }
} | Sort-Object TotalSize -Descending | Select-Object -First $TopN
foreach ($ext in $extStats) {
    $sizeMB = [math]::Round($ext.TotalSize / 1MB, 2)
    $report += "| $($ext.Extension) | $sizeMB MB | $($ext.Count) |\`n"
}
$report += "\`n"
` : ''}
${optDup ? `# é‡è¤‡æª”æ¡ˆåµæ¸¬
$report += "## å¯èƒ½çš„é‡è¤‡æª”æ¡ˆ\`n\`n"
$sizeGroups = $allFiles | Where-Object { $_.Length -gt 1MB } | Group-Object Length | Where-Object { $_.Count -gt 1 }
$duplicates = @()
foreach ($group in $sizeGroups | Select-Object -First 30) {
    $hashes = @{}
    foreach ($file in $group.Group) {
        try {
            $hash = (Get-FileHash $file.FullName -Algorithm SHA256 -ErrorAction Stop).Hash
            if ($hashes.ContainsKey($hash)) {
                $duplicates += [PSCustomObject]@{
                    Size = $file.Length
                    File1 = $hashes[$hash]
                    File2 = $file.FullName
                }
            } else {
                $hashes[$hash] = $file.FullName
            }
        } catch { }
    }
}
if ($duplicates.Count -gt 0) {
    foreach ($dup in $duplicates | Select-Object -First 20) {
        $sizeMB = [math]::Round($dup.Size / 1MB, 2)
        $report += "**[$sizeMB MB] é‡è¤‡:**\`n"
        $report += "- $($dup.File1)\`n"
        $report += "- $($dup.File2)\`n\`n"
    }
} else {
    $report += "æ²’æœ‰ç™¼ç¾é‡è¤‡æª”æ¡ˆã€‚\`n"
}
` : ''}
# å„²å­˜å ±å‘Š
$report | Out-File -FilePath $reportPath -Encoding UTF8
Write-Host "\\nå ±å‘Šå·²ç”¢ç”Ÿï¼š$reportPath" -ForegroundColor Green
Write-Host "å®Œæˆï¼" -ForegroundColor Cyan
`;

            return { skillMd, script };
        }

        // Google Drive ä¸Šå‚³ç”Ÿæˆå™¨
        function generateGdriveUpload(name, desc) {
            const remoteFolder = document.getElementById('remoteFolder').value || 'OpenClaw-Uploads';
            const remoteName = document.getElementById('remoteName').value || 'gdrive';
            const autoLink = document.getElementById('optAutoLink').checked;

            const skillMd = `# ${name}

${desc}

## åŠŸèƒ½
- ä¸Šå‚³æª”æ¡ˆåˆ° Google Drive
- ä¸Šå‚³åˆ°æŒ‡å®šè³‡æ–™å¤¾ï¼š${remoteFolder}
${autoLink ? '- è‡ªå‹•ç”¢ç”Ÿåˆ†äº«é€£çµ\n' : ''}
## å‰ææ¢ä»¶
- å·²å®‰è£ rclone
- å·²å®Œæˆ Google Drive æˆæ¬Šï¼ˆrclone configï¼‰

## ä½¿ç”¨æ–¹å¼
è·Ÿé¾è¦èªªï¼šã€ŒæŠŠ xxx ä¸Šå‚³åˆ° Google Driveã€

## æ‰‹å‹•åŸ·è¡Œ
\`\`\`powershell
& "~/.openclaw/workspace/skills/${name}/scripts/upload.ps1" -FilePath "C:\\path\\to\\file.zip"
\`\`\`
`;

            const script = `# ${name} - ${desc}
# è‡ªå‹•ç”Ÿæˆæ–¼ ${new Date().toLocaleDateString('zh-TW')}

param(
    [Parameter(Mandatory=$true)]
    [string]$FilePath,
    [string]$RemoteFolder = "${remoteFolder}",
    [string]$RemoteName = "${remoteName}"
)

# æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨
if (!(Test-Path $FilePath)) {
    Write-Host "éŒ¯èª¤ï¼šæª”æ¡ˆä¸å­˜åœ¨ - $FilePath" -ForegroundColor Red
    exit 1
}

$fileName = Split-Path $FilePath -Leaf

# æª¢æŸ¥ rclone æ˜¯å¦å®‰è£
if (!(Get-Command rclone -ErrorAction SilentlyContinue)) {
    Write-Host "éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° rcloneï¼Œè«‹å…ˆå®‰è£" -ForegroundColor Red
    Write-Host "å®‰è£æŒ‡ä»¤ï¼šwinget install Rclone.Rclone" -ForegroundColor Yellow
    exit 1
}

# ä¸Šå‚³æª”æ¡ˆ
Write-Host "æ­£åœ¨ä¸Šå‚³ $fileName åˆ° $RemoteName:$RemoteFolder ..." -ForegroundColor Cyan
rclone copy $FilePath "$RemoteName`:$RemoteFolder" --progress

if ($LASTEXITCODE -eq 0) {
    Write-Host "ä¸Šå‚³æˆåŠŸï¼" -ForegroundColor Green
    ${autoLink ? `
    # ç”¢ç”Ÿåˆ†äº«é€£çµ
    Write-Host "æ­£åœ¨ç”¢ç”Ÿåˆ†äº«é€£çµ..." -ForegroundColor Yellow
    $link = rclone link "$RemoteName`:$RemoteFolder/$fileName"
    if ($link) {
        Write-Host "åˆ†äº«é€£çµï¼š" -ForegroundColor Cyan
        Write-Host $link -ForegroundColor Green

        # è¤‡è£½åˆ°å‰ªè²¼ç°¿
        $link | Set-Clipboard
        Write-Host "(å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿)" -ForegroundColor Gray
    }
    ` : ''}
} else {
    Write-Host "ä¸Šå‚³å¤±æ•—ï¼è«‹æª¢æŸ¥ rclone è¨­å®š" -ForegroundColor Red
    exit 1
}
`;

            return { skillMd, script };
        }

        // ç¶²é çˆ¬èŸ²ç”Ÿæˆå™¨
        function generateWebScraper(name, desc) {
            const urls = document.getElementById('targetUrls').value || 'https://example.com';
            const mode = document.getElementById('scrapeMode').value;
            const selector = document.getElementById('cssSelector').value || '.content';

            const modeDesc = {
                'light': 'Light fetchï¼ˆè¼•é‡æŠ“å–ï¼‰',
                'dynamic': 'Dynamic JSï¼ˆç­‰å¾… JavaScriptï¼‰',
                'monitor': 'Scheduled monitorï¼ˆå®šæ™‚ç›£æ§ï¼‰'
            };

            const skillMd = `# ${name}

${desc}

## åŠŸèƒ½
- æŠ“å–æŒ‡å®šç¶²é çš„è³‡æ–™
- æ¨¡å¼ï¼š${modeDesc[mode]}
- CSS é¸æ“‡å™¨ï¼š${selector}

## ç›®æ¨™ç¶²å€
${urls.split('\n').filter(u => u.trim()).map(u => '- ' + u.trim()).join('\n')}

## ä½¿ç”¨æ–¹å¼
è·Ÿé¾è¦èªªï¼šã€ŒåŸ·è¡Œç¶²é çˆ¬èŸ²ã€æˆ–ã€ŒæŠ“å– xxx ç¶²ç«™ã€
`;

            const script = `# ${name} - ${desc}
# è‡ªå‹•ç”Ÿæˆæ–¼ ${new Date().toLocaleDateString('zh-TW')}
# æ¨¡å¼ï¼š${modeDesc[mode]}

param(
    [string[]]$Urls = @(
        ${urls.split('\n').filter(u => u.trim()).map(u => `"${u.trim()}"`).join(',\n        ')}
    ),
    [string]$Selector = "${selector}"
)

$reportDate = Get-Date -Format "yyyy-MM-dd_HHmmss"
$reportDir = "$env:USERPROFILE\\.openclaw\\workspace\\reports\\${name}"
if (!(Test-Path $reportDir)) { New-Item -ItemType Directory -Path $reportDir -Force }
$reportPath = "$reportDir\\$reportDate.md"

$report = "# ç¶²é çˆ¬èŸ²å ±å‘Š - $reportDate\`n\`n"

foreach ($url in $Urls) {
    Write-Host "æŠ“å–ä¸­: $url" -ForegroundColor Cyan
    $report += "## $url\`n\`n"

    try {
        $response = Invoke-WebRequest -Uri $url -UseBasicParsing -TimeoutSec 30

        # ç°¡æ˜“ HTML è§£æï¼ˆPowerShell å…§å»ºï¼‰
        $content = $response.Content

        # ç§»é™¤ script å’Œ style
        $content = $content -replace '<script[^>]*>[\\s\\S]*?</script>', ''
        $content = $content -replace '<style[^>]*>[\\s\\S]*?</style>', ''

        # ç§»é™¤ HTML æ¨™ç±¤ï¼Œä¿ç•™æ–‡å­—
        $text = $content -replace '<[^>]+>', ' '
        $text = $text -replace '\\s+', ' '
        $text = $text.Trim()

        # å–å‰ 2000 å­—å…ƒ
        if ($text.Length -gt 2000) {
            $text = $text.Substring(0, 2000) + "..."
        }

        $report += "\`\`\`\`n$text\`n\`\`\`\`n\`n"
        Write-Host "æˆåŠŸæŠ“å– $($text.Length) å­—å…ƒ" -ForegroundColor Green

    } catch {
        $report += "éŒ¯èª¤ï¼š$($_.Exception.Message)\`n\`n"
        Write-Host "æŠ“å–å¤±æ•—: $($_.Exception.Message)" -ForegroundColor Red
    }
}

$report | Out-File -FilePath $reportPath -Encoding UTF8
Write-Host "\\nå ±å‘Šå·²ç”¢ç”Ÿï¼š$reportPath" -ForegroundColor Green
`;

            return { skillMd, script };
        }

        // æ’ç¨‹æé†’ç”Ÿæˆå™¨
        function generateScheduler(name, desc) {
            const content = document.getElementById('reminderContent').value || 'é€™æ˜¯ä¸€å‰‡æé†’';
            const time = document.getElementById('scheduleTime').value || '09:00';
            const freq = document.getElementById('scheduleFreq').value;

            const freqDesc = {
                'daily': 'æ¯å¤©',
                'weekday': 'é€±ä¸€åˆ°é€±äº”',
                'weekly': 'æ¯é€±',
                'hourly': 'æ¯å°æ™‚'
            };

            const skillMd = `# ${name}

${desc}

## æé†’å…§å®¹
${content}

## æ’ç¨‹è¨­å®š
- åŸ·è¡Œæ™‚é–“ï¼š${time}
- é‡è¤‡é »ç‡ï¼š${freqDesc[freq]}

## ä½¿ç”¨æ–¹å¼
è·Ÿé¾è¦èªªï¼šã€Œè¨­å®šæé†’ã€æˆ–ã€ŒåŸ·è¡Œ ${name}ã€

## æ‰‹å‹•åŸ·è¡Œ
\`\`\`powershell
& "~/.openclaw/workspace/skills/${name}/scripts/remind.ps1"
\`\`\`
`;

            const script = `# ${name} - ${desc}
# è‡ªå‹•ç”Ÿæˆæ–¼ ${new Date().toLocaleDateString('zh-TW')}

param(
    [string]$Message = @"
${content}
"@
)

$timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"

Write-Host "========================================" -ForegroundColor Cyan
Write-Host "â° æé†’æ™‚é–“: $timestamp" -ForegroundColor Yellow
Write-Host "========================================" -ForegroundColor Cyan
Write-Host ""
Write-Host $Message -ForegroundColor Green
Write-Host ""
Write-Host "========================================" -ForegroundColor Cyan

# å¯é¸ï¼šç™¼é€ Windows é€šçŸ¥
# [Windows.UI.Notifications.ToastNotificationManager, Windows.UI.Notifications, ContentType = WindowsRuntime] | Out-Null
# é€™éœ€è¦é¡å¤–çš„è¨­å®šï¼Œæš«æ™‚ç”¨ Write-Host é¡¯ç¤º

# è¨˜éŒ„åˆ°æ—¥èªŒ
$logDir = "$env:USERPROFILE\\.openclaw\\workspace\\logs"
if (!(Test-Path $logDir)) { New-Item -ItemType Directory -Path $logDir -Force }
$logFile = "$logDir\\reminders.log"
"$timestamp - $Message" | Out-File -FilePath $logFile -Append -Encoding UTF8
`;

            return { skillMd, script };
        }

        // æª”æ¡ˆæ•´ç†ç”Ÿæˆå™¨
        function generateFileOrganizer(name, desc) {
            const source = document.getElementById('sourceFolder').value || '$env:USERPROFILE\\Downloads';
            const rule = document.getElementById('organizeRule').value;
            const moveFiles = document.getElementById('optMoveFiles').checked;

            const ruleDesc = {
                'extension': 'ä¾å‰¯æª”ååˆ†é¡',
                'date': 'ä¾æ—¥æœŸåˆ†é¡',
                'size': 'ä¾å¤§å°åˆ†é¡'
            };

            const skillMd = `# ${name}

${desc}

## åŠŸèƒ½
- æ•´ç†è¦å‰‡ï¼š${ruleDesc[rule]}
- ä¾†æºè³‡æ–™å¤¾ï¼š${source}
- æ¨¡å¼ï¼š${moveFiles ? 'ç§»å‹•æª”æ¡ˆ' : 'åªç”¢ç”Ÿå ±å‘Šï¼ˆä¸ç§»å‹•ï¼‰'}

## ä½¿ç”¨æ–¹å¼
è·Ÿé¾è¦èªªï¼šã€Œæ•´ç†ä¸‹è¼‰è³‡æ–™å¤¾ã€æˆ–ã€ŒåŸ·è¡Œ ${name}ã€
`;

            const script = `# ${name} - ${desc}
# è‡ªå‹•ç”Ÿæˆæ–¼ ${new Date().toLocaleDateString('zh-TW')}
# æ•´ç†è¦å‰‡ï¼š${ruleDesc[rule]}

param(
    [string]$SourceFolder = "${source}",
    [switch]$MoveFiles = $${moveFiles}
)

$expandedPath = $ExecutionContext.InvokeCommand.ExpandString($SourceFolder)

if (!(Test-Path $expandedPath)) {
    Write-Host "éŒ¯èª¤ï¼šä¾†æºè³‡æ–™å¤¾ä¸å­˜åœ¨ - $expandedPath" -ForegroundColor Red
    exit 1
}

Write-Host "é–‹å§‹æ•´ç†: $expandedPath" -ForegroundColor Cyan
Write-Host "æ¨¡å¼: ${moveFiles ? 'ç§»å‹•æª”æ¡ˆ' : 'åªç”¢ç”Ÿå ±å‘Š'}" -ForegroundColor Yellow

$files = Get-ChildItem -Path $expandedPath -File

$report = "# æª”æ¡ˆæ•´ç†å ±å‘Š - $(Get-Date -Format 'yyyy-MM-dd HH:mm')\`n\`n"
$report += "ä¾†æºï¼š$expandedPath\`n"
$report += "æª”æ¡ˆæ•¸ï¼š$($files.Count)\`n\`n"

${rule === 'extension' ? `
# ä¾å‰¯æª”ååˆ†é¡
$groups = $files | Group-Object Extension
foreach ($group in $groups | Sort-Object Count -Descending) {
    $ext = if ($group.Name) { $group.Name } else { "ç„¡å‰¯æª”å" }
    $report += "## $ext ($($group.Count) å€‹æª”æ¡ˆ)\`n"
    foreach ($file in $group.Group) {
        $report += "- $($file.Name)\`n"
        if ($MoveFiles) {
            $destDir = Join-Path $expandedPath $ext.TrimStart('.')
            if (!(Test-Path $destDir)) { New-Item -ItemType Directory -Path $destDir -Force | Out-Null }
            Move-Item $file.FullName $destDir -Force
        }
    }
    $report += "\`n"
}
` : ''}
${rule === 'date' ? `
# ä¾æ—¥æœŸåˆ†é¡
$groups = $files | Group-Object { $_.LastWriteTime.ToString("yyyy-MM") }
foreach ($group in $groups | Sort-Object Name -Descending) {
    $report += "## $($group.Name) ($($group.Count) å€‹æª”æ¡ˆ)\`n"
    foreach ($file in $group.Group) {
        $report += "- $($file.Name)\`n"
        if ($MoveFiles) {
            $destDir = Join-Path $expandedPath $group.Name
            if (!(Test-Path $destDir)) { New-Item -ItemType Directory -Path $destDir -Force | Out-Null }
            Move-Item $file.FullName $destDir -Force
        }
    }
    $report += "\`n"
}
` : ''}
${rule === 'size' ? `
# ä¾å¤§å°åˆ†é¡
$categories = @{
    "01-å°æª”æ¡ˆ(å°æ–¼1MB)" = { $_.Length -lt 1MB }
    "02-ä¸­æª”æ¡ˆ(1-100MB)" = { $_.Length -ge 1MB -and $_.Length -lt 100MB }
    "03-å¤§æª”æ¡ˆ(100MB-1GB)" = { $_.Length -ge 100MB -and $_.Length -lt 1GB }
    "04-è¶…å¤§æª”æ¡ˆ(å¤§æ–¼1GB)" = { $_.Length -ge 1GB }
}
foreach ($cat in $categories.GetEnumerator() | Sort-Object Key) {
    $catFiles = $files | Where-Object $cat.Value
    if ($catFiles.Count -gt 0) {
        $report += "## $($cat.Key) ($($catFiles.Count) å€‹æª”æ¡ˆ)\`n"
        foreach ($file in $catFiles) {
            $sizeMB = [math]::Round($file.Length / 1MB, 2)
            $report += "- [$sizeMB MB] $($file.Name)\`n"
            if ($MoveFiles) {
                $destDir = Join-Path $expandedPath $cat.Key
                if (!(Test-Path $destDir)) { New-Item -ItemType Directory -Path $destDir -Force | Out-Null }
                Move-Item $file.FullName $destDir -Force
            }
        }
        $report += "\`n"
    }
}
` : ''}

$reportDir = "$env:USERPROFILE\\.openclaw\\workspace\\reports\\${name}"
if (!(Test-Path $reportDir)) { New-Item -ItemType Directory -Path $reportDir -Force }
$reportPath = "$reportDir\\$(Get-Date -Format 'yyyy-MM-dd').md"
$report | Out-File -FilePath $reportPath -Encoding UTF8

Write-Host "\\nå ±å‘Šå·²ç”¢ç”Ÿï¼š$reportPath" -ForegroundColor Green
if ($MoveFiles) { Write-Host "æª”æ¡ˆå·²ç§»å‹•å®Œæˆï¼" -ForegroundColor Cyan }
`;

            return { skillMd, script };
        }

        // è‡ªå‹•å‚™ä»½ç”Ÿæˆå™¨
        function generateBackup(name, desc) {
            const sources = document.getElementById('backupSources').value || '$env:USERPROFILE\\Documents';
            const dest = document.getElementById('backupDest').value || 'D:\\Backups';
            const mode = document.getElementById('backupMode').value;

            const modeDesc = {
                'copy': 'å®Œæ•´è¤‡è£½',
                'sync': 'åŒæ­¥',
                'incremental': 'å¢é‡å‚™ä»½'
            };

            const skillMd = `# ${name}

${desc}

## è¨­å®š
- å‚™ä»½ä¾†æºï¼š
${sources.split('\n').filter(s => s.trim()).map(s => '  - ' + s.trim()).join('\n')}
- å‚™ä»½ç›®çš„åœ°ï¼š${dest}
- å‚™ä»½æ¨¡å¼ï¼š${modeDesc[mode]}

## ä½¿ç”¨æ–¹å¼
è·Ÿé¾è¦èªªï¼šã€ŒåŸ·è¡Œå‚™ä»½ã€æˆ–ã€Œå‚™ä»½æˆ‘çš„æª”æ¡ˆã€
`;

            const rcloneCmd = mode === 'sync' ? 'sync' : 'copy';

            const script = `# ${name} - ${desc}
# è‡ªå‹•ç”Ÿæˆæ–¼ ${new Date().toLocaleDateString('zh-TW')}
# å‚™ä»½æ¨¡å¼ï¼š${modeDesc[mode]}

param(
    [string[]]$Sources = @(
        ${sources.split('\n').filter(s => s.trim()).map(s => `"${s.trim()}"`).join(',\n        ')}
    ),
    [string]$Destination = "${dest}"
)

$timestamp = Get-Date -Format "yyyy-MM-dd_HHmmss"
$logDir = "$env:USERPROFILE\\.openclaw\\workspace\\logs"
if (!(Test-Path $logDir)) { New-Item -ItemType Directory -Path $logDir -Force }
$logFile = "$logDir\\backup_$timestamp.log"

Write-Host "========================================" -ForegroundColor Cyan
Write-Host "é–‹å§‹å‚™ä»½ - $timestamp" -ForegroundColor Yellow
Write-Host "ç›®çš„åœ°: $Destination" -ForegroundColor Gray
Write-Host "========================================" -ForegroundColor Cyan

"å‚™ä»½é–‹å§‹: $timestamp" | Out-File $logFile -Encoding UTF8

foreach ($source in $Sources) {
    $expandedSource = $ExecutionContext.InvokeCommand.ExpandString($source)

    if (!(Test-Path $expandedSource)) {
        Write-Host "è·³éï¼ˆä¸å­˜åœ¨ï¼‰: $expandedSource" -ForegroundColor Yellow
        "è·³é: $expandedSource (ä¸å­˜åœ¨)" | Out-File $logFile -Append -Encoding UTF8
        continue
    }

    $folderName = Split-Path $expandedSource -Leaf
    $destPath = if ($Destination -match ":") {
        # å¦‚æœæ˜¯ rclone remoteï¼ˆå¦‚ gdrive:Backupsï¼‰
        "$Destination/$folderName"
    } else {
        Join-Path $Destination $folderName
    }

    Write-Host "å‚™ä»½ä¸­: $expandedSource -> $destPath" -ForegroundColor Cyan

    if ($Destination -match "^[a-zA-Z]+:") {
        # ä½¿ç”¨ rcloneï¼ˆé›²ç«¯å‚™ä»½ï¼‰
        rclone ${rcloneCmd} "$expandedSource" "$destPath" --progress
    } else {
        # æœ¬æ©Ÿå‚™ä»½
        if (!(Test-Path $destPath)) { New-Item -ItemType Directory -Path $destPath -Force | Out-Null }

        $files = Get-ChildItem -Path $expandedSource -Recurse -File
        $count = 0
        foreach ($file in $files) {
            $relativePath = $file.FullName.Substring($expandedSource.Length)
            $targetPath = Join-Path $destPath $relativePath
            $targetDir = Split-Path $targetPath -Parent
            if (!(Test-Path $targetDir)) { New-Item -ItemType Directory -Path $targetDir -Force | Out-Null }
            Copy-Item $file.FullName $targetPath -Force
            $count++
        }
        Write-Host "å·²è¤‡è£½ $count å€‹æª”æ¡ˆ" -ForegroundColor Green
    }

    "å®Œæˆ: $expandedSource -> $destPath" | Out-File $logFile -Append -Encoding UTF8
}

Write-Host "========================================" -ForegroundColor Cyan
Write-Host "å‚™ä»½å®Œæˆï¼" -ForegroundColor Green
Write-Host "æ—¥èªŒæª”: $logFile" -ForegroundColor Gray
"å‚™ä»½å®Œæˆ: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')" | Out-File $logFile -Append -Encoding UTF8
`;

            return { skillMd, script };
        }

        // è‡ªè¨‚ Skill ç”Ÿæˆå™¨
        function generateCustom(name, desc) {
            const trigger = document.getElementById('customTrigger').value || 'åŸ·è¡Œæˆ‘çš„ä»»å‹™';
            const script = document.getElementById('customScript').value || 'Write-Host "Hello from my custom skill!"';

            const skillMd = `# ${name}

${desc}

## è§¸ç™¼æŒ‡ä»¤
è·Ÿé¾è¦èªªï¼šã€Œ${trigger}ã€

## åŠŸèƒ½èªªæ˜
è‡ªè¨‚æŠ€èƒ½ï¼ŒåŸ·è¡Œä»¥ä¸‹è…³æœ¬ã€‚

## ä½¿ç”¨æ–¹å¼
\`\`\`
${trigger}
\`\`\`
`;

            const fullScript = `# ${name} - ${desc}
# è‡ªå‹•ç”Ÿæˆæ–¼ ${new Date().toLocaleDateString('zh-TW')}
# è§¸ç™¼æŒ‡ä»¤ï¼š${trigger}

${script}
`;

            return { skillMd, script: fullScript };
        }

        // ä¸‹è¼‰å–®ä¸€æª”æ¡ˆ
        function downloadFile(type) {
            if (!generatedFiles[type]) {
                alert('è«‹å…ˆç”Ÿæˆ Skillï¼');
                return;
            }

            const file = generatedFiles[type];
            const blob = new Blob([file.content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = file.filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ä¸‹è¼‰å…¨éƒ¨ï¼ˆæ¨¡æ“¬ ZIPï¼Œå¯¦éš›ä¸Šåˆ†åˆ¥ä¸‹è¼‰ï¼‰
        function downloadAll() {
            // ç”±æ–¼ç´”å‰ç«¯é›£ä»¥å»ºç«‹çœŸæ­£çš„ ZIPï¼Œæ”¹ç‚ºé€ä¸€ä¸‹è¼‰
            downloadFile('skill-md');
            setTimeout(() => downloadFile('script'), 500);
            setTimeout(() => downloadFile('install'), 1000);
        }

        // åˆå§‹åŒ–
        updateDefaultName();
    </script>
</body>
</html>
